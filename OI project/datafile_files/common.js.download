'use strict';

var whereiam = 'onpremise';
var hiLocale = 'hi-u-nu-deva';
var enLocale = 'en-IN';
var guLocale = 'hi-u-nu-gujr';
var hiLocaleAcronnym = 'hi';
var enLocaleAcronnym = 'en';
var guLocaleAcronnym = 'gu';
var mrLocaleAcronnym = 'mr';
var archivenewUrlPart = "https://nsearchives.nseindia.com/web/sites/default/files/";
var localeMap = {
    'hi': hiLocale,
    'gu': guLocale,
    'mr': hiLocale,
    'en': enLocale
};
var niftyHeaderSocket = false,
    timeoutID = void 0;
var eqMarketScriptCall;
// setCookie("defaultLang", enLocaleAcronnym); // commented default lang cokkie
var selectedLang = getCookie("lang");
var defaultLang = getCookie("defaultLang");
var selectedLocalecommon;
var tablemarketTurnover = void 0;
switch (selectedLang) {
    case hiLocaleAcronnym:
        selectedLocalecommon = localeMap[selectedLang];
        $('body').addClass(selectedLang);
        break;
    case guLocaleAcronnym:
        selectedLocalecommon = localeMap[selectedLang];
        $('body').addClass(selectedLang);
        break;
    case mrLocaleAcronnym:
        selectedLocalecommon = localeMap[selectedLang];
        // add class into body
        $('body').addClass(selectedLang);
        break;
    default:
        selectedLocalecommon = enLocale;
        // add class into body
        $('body').addClass(selectedLang);
        break;
}
var pageScrollTableIdString;
var pageScrolltableId;
var pageScrolltableHead;
var pageScrollOCTablePos;
var pageScrolltabWid;
var updateVal = true;
var currencyMap = [{ name: "usd", value: "$" }, { name: "euro", value: "€" }, { name: "gbp", value: "₤" }, { name: "yen", value: "¥" }];
var loader = '<div class="loader-wrp"><div class="spin-loader" aria-hidden="true"></div></div>';
var $marketSlider = void 0;
var $derivSlider = void 0;
// $(window).on('load', function () {
//     $('#pageLoader').fadeOut();
// })
var companyAutoCompleteData = void 0;
var applyCompanyAutoCompleteFilter = void 0;
var MAX_MOBILE_WIDTH = 767;

var tabLegend = new Map([['equities', 'equity'], ['sme', 'sme'], ['debt', 'bonds'], ['mf', 'Mutual Funds']]);

var EnDLegends = new Map([['FUTCUR', 'Currency Futures'], ['OPTCUR', 'Currency Options'], ['FUTSTK', 'Stock Futures'], ['OPTSTK', 'Stock Options'], ['FUTIDX', 'Index Futures'], ['OPTIDX', 'Index Options'], ['FUTIRC', 'Interest Rate Futures'], ['FUTIRT', 'Govt. Sec. Futures'], ['FUTBLN', 'Bullion Futures'], ['FUTENR', 'Energy Futures'], ['FUTAGR', 'Agri Futures'], ['FUTBAS', 'Base Metal Futures'], ['OPTBAS', 'Base Metal Options'], ['CE', 'Call'], ['PE', 'Put'], ['FF', 'FF'], ['XX', '-'], ['OPTIRC', 'G-Sec Options']]);

var niftyTypes = ["NIFTY 50", "NIFTY NEXT 50", "NIFTY MIDCAP SELECT", "NIFTY BANK", "NIFTY FINANCIAL SERVICES"];
var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
var companyFilter = false;
var entityMap = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#39;',
    '/': '/',
    '`': '&#x60;',
    '=': '&#x3D;'
};
var QLCorpCom = [];
var quickBtn = false;
var autoPlayMarket = void 0,
    QLCorpTable = void 0,
    tabIndex = void 0,
    autoUpdateMarket = void 0;

var equityKey = 'equity',
    derivativeKey = 'derivatives',
    slbKey = 'slb',
    bondsKey = 'bonds';

var activeTabNo = 0;
var activeTabVal = void 0;
var ua = window.navigator.userAgent;
var lastScrollAt = Date.now(),
    timeout = void 0;

var errSnackbarTimeout;

// Ignore list for Disclaimer logic
var ignoreDisclaimer = ["https://enit.nseindia.com/MemDirWeb/searchBrokers_Beta?step=searchBrokersList", "https://enit.nseindia.com/MemDirWeb/form/tradingMemberLocator_beta.jsp"];

var valueTypObjectConvention = {
    "lakhs": {
        "lakhs": 1,
        "crores": 0.01,
        "billions": 0.0001
    },
    "crores": {
        "lakhs": 100,
        "crores": 1,
        "billions": 0.01
    },
    "billions": {
        "lakhs": 10000,
        "crores": 100,
        "billions": 1
    }
};

function escapeHtml(string) {
    var query = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

    if (query) {
        return String(string).replace(/[<>"'`=\/]/g, function fromEntityMap(s) {
            return entityMap[s];
        });
    } else {
        return String(string).replace(/[&<>"'`=\/]/g, function fromEntityMap(s) {
            return entityMap[s];
        });
    }
}

$(function () {
    //customDropdown();

    tableHeaderFix();

    /* Select overlapping issue fix */
    $('#main_navbar li').hover(function () {
        $('select').blur();
    });
    /* Select overlapping issue fix End */

    /* Market Status Hover Stop Animation */
    /*$('#nseMarketStatus').hover(function(){
        clearTimeout(autoPlayMarket);
    }, function(){
        autoplayMarketStatus();
    })*/
    /* End */

    /* collapse banner */
    var nav = $("#main_slider"),
        animateTime = 500,
        navLink = $('.collpase_btn a');
    navLink.click(function (e) {
        $(this).parent().toggleClass('link_collapsed');
        $("#main_slider").toggleClass("bnr_height");
        if (nav.height() === 200) {
            autoHeightAnimate(nav, animateTime);
            $(this).attr('aria-expanded', 'true');
        } else {
            nav.stop().animate({ height: '200' }, animateTime);
            $(this).attr('aria-expanded', 'false');
        }
        e.preventDefault();
    }).click();

    /* Function to animate height: auto */
    function autoHeightAnimate(element, time) {
        var curHeight = element.height(),
            autoHeight = element.css('height', 'auto').height();
        element.height(curHeight);
        element.stop().animate({ height: autoHeight }, time);
    }

    /* @end collapse banner */

    /* fixed header */
    function re_head_height() {
        var header_height = $('header').height();
        $('body').css('padding-top', header_height);
    }

    re_head_height();
    $(window).resize(function () {
        re_head_height();
    });
    /* end fixed header */

    $('.subscribe_toggle').on(' click', function (event) {
        // event.preventDefault();
        $('.subscribe_toggle .card-body').toggleClass('open');
        $(this).find('.card-title').attr('aria-expanded', true);
    });
    $('.subscribe_toggle').on('mouseleave', function () {
        $('.subscribe_toggle .card-body').removeClass('open');
        $(this).find('.card-title').attr('aria-expanded', false);
    });

    /* collapsible search */
    var submitIcon = $('.searchbox-icon');
    var inputBox = $('.searchbox-input');
    var searchBox = $('.expnd_searchbox');
    var isOpen = false;
    submitIcon.click(function () {
        if (isOpen == false) {
            searchBox.addClass('searchbox-open');
            inputBox.focus();
            isOpen = true;
        } else {
            searchBox.removeClass('searchbox-open');
            inputBox.focusout();
            isOpen = false;
        }
    });
    submitIcon.mouseup(function () {
        return false;
    });
    searchBox.mouseup(function () {
        return false;
    });
    $(document).mouseup(function () {
        if (isOpen == true) {
            $('.searchbox-icon').css('display', 'block');
            submitIcon.click();
        }
    });

    /* footer accordion */
    $(".nav-folderized .foot-nav h6").click(function () {
        $(".nav-folderized .foot-nav").removeClass('open');
        $(this).parent(".foot-nav").toggleClass("open");
    });

    /* dropdown menu */
    $('.dropdown-menu').mouseenter(function () {
        if ($(this).is(":visible")) {
            $(this).prev('.dd-link').addClass('active');
        }
    }).mouseleave(function () {
        if ($(this).is(":visible")) {
            $(this).prev('.dd-link').removeClass('active');
        }
    });

    // $('.dd-link').on('click', function(e){
    //     if(Modernizr.mq('screen and (max-width:767px)')) {
    //         //e.preventDefault();
    //         $(this).parent().find('.dropdown-menu').slideToggle();
    //     }
    // });

    // Remove above command and added new jquery code    
    $(document).ready(function () {
        if ($(window).width() < 767) {
            $(this).parent().find('.dropdown-menu').slideToggle();
        }
    });

    $('.setting_btn').click(function (e) {
        //alert('');
        e.preventDefault();
        $('.setting_wrap').toggleClass('active');
        if ($('.setting_wrap').hasClass('active')) {
            $(this).find('a').attr('aria-expanded', true);
            setTimeout(function () {
                $('.setting_wrap .setting_body a').eq(0).focus();
            }, 500);
        } else {
            $(this).find('a').attr('aria-expanded', false);
        }
    });

    $('.loginIconBtn').click(function (e) {
        //alert('');
        e.preventDefault();
        $('.login_wrap').toggleClass('active');
    });

    /* Company AutoComplete */
    var CFCompany = function CFCompany() {
        var uri = '/api/search/autocomplete?q=%QUERY';
        if (typeof symbol_type !== "undefined") {
            uri += '&symbol_type=' + symbol_type;
        }

        return new Bloodhound({
            datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            remote: {
                url: uri,
                wildcard: '%QUERY',
                replace: function replace(url, uriEncodedQuery) {
                    url = url.replace('%QUERY', uriEncodedQuery);
                    var activeTab = $('#Company_Directory').find('.nav-link.active').data('tab');
                    return activeTab ? url + '&symbol_type=' + (tabLegend.get(activeTab) || 'equity') : url;
                },
                filter: function filter(response) {
                    return [].concat(response.symbols, response.mfsymbols);
                }
            }
        });
    };

    applyCompanyAutoCompleteFilter = function applyCompanyAutoCompleteFilter(fieldId) {
        $('' + (fieldId ? fieldId : '.companyAutoComplete')).typeahead({
            highlight: false,
            hint: false,
            minLength: 2
        }, {
            name: 'Company',
            display: 'symbol_info',
            source: CFCompany(),
            templates: {
                empty: function empty(data) {
                    $('' + (fieldId ? fieldId : '.companyAutoComplete')).attr('aria-expanded', true);
                    return '<div class="autocompleteList">\n                                <p class="line1">\n                                    <span>No record found</span>\n                                </p>\n                            </div>';
                },
                suggestion: function suggestion(data) {
                    $('' + (fieldId ? fieldId : '.companyAutoComplete')).attr('aria-expanded', true);
                    return '<div class="autocompleteList">\n                                <p class="line1">\n                                    <span class="lt">' + data.symbol_info + '</span>\n                                    <span>' + data.symbol + '</span>\n                                </p>\n                            </div>';
                }
            }
        }).bind("typeahead:selected", function (obj, datum, name) {
            $(this).data("value", datum.symbol);
            $(this).data("type", datum.result_sub_type);
            companyAutoCompleteData = $(this);
            if (companyFilter) {
                var filters = getFilterValues($(this));
                filterlogic(filters);
            }
        })
        // .on('typeahead:open', function (event, data) {
        //     $(`${fieldId ? fieldId : '.companyAutoComplete'}`).attr('aria-expanded', true);
        // })
        .on('typeahead:close', function (event, data) {
            $('' + (fieldId ? fieldId : '.companyAutoComplete')).attr('aria-expanded', false);
        });
    };

    applyCompanyAutoCompleteFilter();

    /* Company AutoComplete end */
    QLCorpCom = [];
    $('.QLAutocomplete').typeahead(null, {
        name: 'Company',
        display: 'symbol_info',
        source: CFCompany(),
        highlight: false,
        hint: false,
        templates: {
            empty: function empty(data) {
                return '<div class="autocompleteList">\n                            <p class="line1">\n                                <span>No record found</span>\n                            </p>\n                        </div>';
            },
            suggestion: function suggestion(data) {
                return '<div class="autocompleteList">\n                            <p class="line1">\n                                <span class="lt">' + data.symbol_info + '</span>\n                                <span>' + data.symbol + '</span>\n                            </p>\n                        </div>';
            }
        }
    }).bind("typeahead:selected", function (obj, datum, name) {
        if (QLCorpCom.length >= 5) {
            alert("You can only select 5 Companies");
        } else if (QLCorpCom.includes(datum.symbol)) {
            alert("Company is already selected");
        } else {
            QLCorpCom.push(datum.symbol);
        }
        genComList(QLCorpCom);
        $('.QLAutocomplete').typeahead('val', '');
    })
    /*.on('typeahead:open', function (event, data) {
        $('.QLAutocomplete').attr('aria-expanded', true);
    })
    .on('typeahead:close', function (event, data) {
        $('.QLAutocomplete').attr('aria-expanded', false);
    })*/;
    /* LHS Menu / Tabs */
    $('.nav-tabs--left .nav-item a').click(function () {
        $('.vert_subtabs a').removeClass('sel');
        if ($(this).parent().hasClass('vert_subtabs')) {
            $(this).parent().find('a:first-child').addClass('sel');
        }
    });
    /* End */
    /* Quick Links */
    $('#quickLinkBtn').click(function () {
        try {
            quickBtn = false;
            $('#quickLinkBtn').fadeOut();
            $('.footer_strip').animate({
                width: "toggle"
            });
        } catch (e) {
            console.log("quickLinkBtn Error", e.message);
        }
    });
    $('.footer-tabs li:first-child').click(function () {
        try {
            quickBtn = true;
            $('#quickLinkBtn').fadeIn();
            $('.footer_strip').animate({
                width: "toggle"
            });
        } catch (e) {
            console.log("quickLinkBtn Error", e.message);
        }
    });
    /* End */
    /* Modal Popup Close */
    $('.modal-backdrop').click(function () {
        $('.qlinks_modal .close').trigger('click');
    });
    $(document).keyup(function (e) {
        if (e.key === "Escape") {
            // escape key maps to keycode `27`
            $('.qlinks_modal .close').trigger('click');
        }
    });
    /* End */
    /*$( document ).ajaxStop(function() {
        $('#pageLoader').hide();
        alert("ajaxStop page Loaded");
    });
      $( document ).ajaxComplete(function() {
        alert("ajaxComplete page Loaded");
    });
      $( document ).ajaxSuccess(function() {
        alert("ajaxSuccess page Loaded");
    });*/

    // Temp
    $("#betaVerBand .readMore").click(function () {
        var link = $(this);
        $('#betaVerBand .dots').toggle();
        $('#betaVerBand .subText').slideToggle(function () {
            if ($(this).is(':visible')) {
                link.text('close');
            } else {
                link.text('Read More');
            }
        });
    });
    // end Temp

    $('label[aria-label="Select Report"]').on('click keypress', function () {
        var _this = $(this);
        if (_this.find('input').is(":checked")) {
            _this.attr('aria-checked', true);
        } else {
            _this.attr('aria-checked', false);
        }
    });
});

/* end collapsible search */

function tableHeaderFix() {
    /* Table first column freeze */
    // table-wrap - scrollWrap
    $('.scrollWrap').scroll(function (e) {
        //detect a scroll event on the tbody
        try {
            var _this = $(this);
            var _scrollTop = _this.scrollTop();

            if (isIE(ua)) {
                lastScrollAt = Date.now();
                clearTimeout(timeout);
                _this.find('.tableScroll > thead').css("opacity", 0);
                timeout = setTimeout(function () {
                    if (Date.now() - lastScrollAt > 99) _this.find('.tableScroll > thead').css("opacity", 1);
                }, 150);
            }
            _this.find('.tableScroll > thead').css("top", _scrollTop - 1); //fix thead of the table
            _this.find('.tableScroll .freezed-row').css("top", _scrollTop - 1); //fix thead of the table
            if ($(window).width() > 320) {
                //$('#equityStockTable thead').css("left", -$(".table-wrap").scrollLeft()); //fix the thead relative to the body scrolling
                _this.find('table:first-of-type .tableScroll > thead  th:nth-child(1)').css("left", _this.scrollLeft() - 1); //fix the first cell of the header
                _this.find('table:first-of-type .tableScroll > tbody  td:nth-child(1)').css("left", _this.scrollLeft() - 1); //fix the first column of tdbody
                _this.find('table:first-of-type .tableScroll_col_two > thead  th:nth-child(2)').css("left", _this.scrollLeft() - 1); //fix the first cell of the header
                _this.find('table:first-of-type .tableScroll_col_two > tbody  td:nth-child(2)').css("left", _this.scrollLeft() - 1); //fix the first column of tdbody
            } else {
                $('table:first-of-type .tableScroll > thead  th:nth-child(1)').css("left", 0); //fix the first cell of the header
                $('table:first-of-type .tableScroll > tbody  td:nth-child(1)').css("left", 0); //fix the first column of tdbody
            }
        } catch (e) {
            console.log("tableScroll Scroll", e.message);
        }
    });
    /* Table first column freeze end */
}
function isIE(userAgent) {
    userAgent = userAgent || navigator.userAgent;
    return userAgent.indexOf("MSIE ") > -1 || userAgent.indexOf("Trident/") > -1 || userAgent.indexOf("Edge/") > -1;
}
function closeAlertBox() {
    try {
        $('#alertContainer').fadeOut();
        setCookie('alertBandChecked', true, 1 / 24);
    } catch (e) {
        console.log(e);
    }
}
function checkAlertBandCookie() {
    try {
        var checkAlertCookie = getCookie('alertBandChecked');
        if (checkAlertCookie !== null && typeof checkAlertCookie !== 'undefined' && checkAlertCookie === 'true') {
            $('#alertContainer').hide();
        }
    } catch (e) {
        console.log(e);
    }
}
/* footer strip show hide on scroll */
//$(".footer_strip").hide();
$(window).scroll(function () {
    if ($(window).scrollTop() > 100) {

        quickBtn ? $("#quickLinkBtn").slideDown("slow") : $(".footer_strip").slideDown("slow");
        if ($('#alertContainer').is(':visible')) {
            var quickBandHeight = $('#quickLinkBand').height();
            $('#alertContainer').css({ 'bottom': quickBandHeight });
        }
        //  $('#betaVerBand').slideUp('fast');
        //  $('body').removeClass('showBand');
    } else {
        quickBtn ? $("#quickLinkBtn").slideUp("fast") : $(".footer_strip").slideUp("fast");
        if ($('#alertContainer').is(':visible')) {
            $('#alertContainer').css({ 'bottom': 0 });
        }
        //  $('#betaVerBand').slideDown('fast');
        //  $('body').addClass('showBand');
    }
    if ($('.optionChainTable:visible').length > 0) {
        OCHeaderFix($(window).scrollTop());
    }
    // if($('#yearly_table-reference:visible').length > 0){
    //     MASHeaderFix($(window).scrollTop());
    // }

    PageScrollTableHeaderFix();
});
/* end footer strip show hide */

// Tab Active Center - start
$(function () {

    /* For Beta to old website navigation Band */
    $('body').addClass('showBand'); /* To remove kindly search all 'showBand' class and remove */
    /* End */

    //if($('.live_mkt_watch .common-tabs .subtabs .nav-tabs .nav-link.active').length){
    if ($('.common-tabs .nav-tabs .nav-link.active').length) {
        var left = $('.nav-link.active').offset().left;
        var width = $('.nav-tabs').width();
        var diff = left - width / 2 + 50;
        $('.nav-tabs').scrollLeft($('.nav-tabs').scrollLeft() + diff);
    };

    /* tip off page */
    $('#tipoff_detail').change(function () {
        if ($(this).val() == 'Yes') {
            $('.details_div').slideDown();
        } else {
            $('.details_div').slideUp();
        }
    });
    /* end tip off page */
});

$(function () {
    if ($('.live_mkt_watch .common-tabs .tab-menu .nav-link a.active').length) {
        var left = $('.nav-link a.active').offset().left;
        var width = $('.tab-menu').width();
        var diff = left - width / 2 + 100;
        $('.tab-menu').scrollLeft($('.tab-menu').scrollLeft() + diff);
    }
});

// Tab Active Center - End

/* start dropdown menu */
function toggleNavbarMethod() {
    if ($(window).width() > 768) {
        $('.navbar .dropdown').on('mouseover', function () {
            $('.nav-link.dd-link', this).trigger('click');
        }).on('mouseout', function () {
            $('.dropdown', this).trigger('click').blur();
        });
    } else {
        $('.navbar .dropdown').off('mouseover').off('mouseout');
    }
}
toggleNavbarMethod();
$(window).resize(toggleNavbarMethod);
/* end dropdown menu */

/* quick links */
$(function () {

    $('.footer_strip ul li a').click(function () {
        if (!$(this).hasClass('oldSite')) {
            $('.footer_strip ul li a').removeClass('active');
            $(this).addClass('active');
            $('body').addClass('qlinks-modalopen');
        }
    });
    ////////// added on feb 8 2019 /////////////////////
    $('.link_investors').on('click', function () {
        $('.modal').modal('hide');
        $('#qlink_investors').modal('show');
        $('body').addClass('qlinks-modalopen');
    });
    $('.link_corporates').on('click', function () {
        $('.modal').modal('hide');
        $('#qlink_corporates').modal('show');
        $('body').addClass('qlinks-modalopen');
    });
    $('.link_members').on('click', function () {
        $('.modal').modal('hide');
        $('#qlink_members').modal('show');
        $('body').addClass('qlinks-modalopen');
    });

    $("#qlink_investors").on("hide.bs.modal", function () {
        setTimeout(function () {
            $('.footer_strip ul li a.link_investors').removeClass('active');
        }, 100);
    });
    $("#qlink_corporates").on("hide.bs.modal", function () {
        $('.footer_strip ul li a.link_corporates').removeClass('active');
    });
    $("#qlink_members").on("hide.bs.modal", function () {
        $('.footer_strip ul li a.link_members').removeClass('active');
    });

    $('.footer_strip ul li:first-child a').off('click').removeClass('active');

    ////////// end added on feb 8 2019 /////////////////////
});
/* end quick links */

/* chart javascript */
var graphSymbol = void 0;
function generateChart(api, id) {

    try {
        var preOpenDate = new Date();
        var norMarDate = new Date();
        preOpenDate = preOpenDate.setHours(8, 30, 0, 0);
        norMarDate = norMarDate.setHours(10, 30, 0, 0);
        $.getJSON(api, function (data) {
            // Create the chart
            if (data) {
                $.getJSON(api + '&preopen=true', function (preOpenData) {
                    if (preOpenData) {
                        graphSymbol = preOpenData.name;

                        // const lng = document.getElementById('listlanguages').value;
                        // if(lng==='hi'){
                        // Highcharts.setOptions({
                        //     lang: {
                        //       months: [
                        //         "जनवरी",
                        //         "फरवरी",
                        //         "मार्च",
                        //         "अप्रैल",
                        //         "मई",
                        //         "जून",
                        //         "जुलाई",
                        //         "अगस्त",
                        //         "सितम्बर",
                        //         "अक्टूबर",
                        //         "नवम्बर",
                        //         "दिसम्बर",
                        //       ],
                        //       shortMonths: [
                        //         "जनवरी",
                        //         "फरवरी",
                        //         "मार्च",
                        //         "अप्रैल",
                        //         "मई",
                        //         "जून",
                        //         "जुलाई",
                        //         "अगस्त",
                        //         "सितम्बर",
                        //         "अक्टूबर",
                        //         "नवम्बर",
                        //         "दिसम्बर",
                        //       ],
                        //       weekdays: [
                        //         "रविवार",
                        //         "सोमवार",
                        //         "मंगलवार",
                        //         "बुधवार",
                        //         "गुरुवार",
                        //         "शुक्रवार",
                        //         "शनिवार",
                        //       ],
                        //       thousandsSep: " ",
                        //       decimalPoint: ",",
                        //       rangeSelectorFrom: "0",
                        //       rangeSelectorTo: "50",
                        //     },
                        //   });
                        // }
                        Highcharts.stockChart(id, {
                            chart: {
                                marginTop: 15
                            },
                            rangeSelector: {
                                enabled: false,
                                selected: 1,
                                inputEnabled: false
                            },
                            credits: {
                                enabled: false
                            },
                            title: false,
                            navigator: {
                                enabled: false
                            },
                            scrollbar: {
                                enabled: false
                            },
                            xAxis: {
                                type: 'datetime'
                            },
                            shared: {
                                enabled: true
                            },
                            yAxis: {
                                gridLineWidth: 0,
                                minorGridLineWidth: 0,
                                opposite: false,
                                plotLines: [{
                                    color: '#333',
                                    width: 1,
                                    value: data.closePrice
                                }]
                            },
                            exporting: {
                                enabled: true,
                                buttons: {
                                    contextButton: {
                                        y: -15
                                    }
                                }
                            },
                            series: [{
                                name: preOpenData.identifier || "",
                                data: preOpenData.grapthData || [],
                                type: 'area',
                                //softThreshold:false,
                                //threshold: 'closePrice',
                                threshold: null,
                                tooltip: {
                                    valueDecimals: 2
                                },
                                /*zones: [{
                                    value: data.closePrice,
                                    color: 'red'
                                }, {
                                    color: 'green'
                                }],*/
                                zones: [{
                                    value: preOpenDate,
                                    color: 'orange',
                                    fillColor: {
                                        linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
                                        stops: [[0, '#FFDCAB'], // start
                                        [1, '#fff'] // end
                                        ]
                                    }
                                }, {
                                    value: norMarDate,
                                    color: '#FEAB25',
                                    fillColor: {
                                        linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
                                        stops: [[0, '#FFDCAB'], // start
                                        [1, '#fff'] // end
                                        ]
                                    }
                                }, {
                                    color: 'green',
                                    fillColor: {
                                        linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
                                        stops: [[0, '#3e85c5'], // start
                                        [1, 'rgba(11, 232, 250, 0)'] // end
                                        ]
                                    }
                                }],
                                plotOptions: {
                                    series: {
                                        color: '#3e85c5',
                                        lineWidth: 1
                                    }
                                },
                                fillColor: {
                                    linearGradient: {
                                        x1: 0,
                                        y1: 0,
                                        x2: 0,
                                        y2: 1
                                    },
                                    stops: [[0, '#3e85c5'], [1, 'rgba(11, 232, 250, 0)']]
                                } }, {
                                name: data.identifier || "",
                                data: data.grapthData || [],
                                type: 'area',
                                //softThreshold:false,
                                //threshold: 'closePrice',
                                threshold: null,
                                tooltip: {
                                    valueDecimals: 2
                                },
                                zones: [{
                                    value: data.closePrice,
                                    color: 'red'
                                }, {
                                    color: 'green'
                                }],
                                plotOptions: {
                                    series: {
                                        color: '#3e85c5',
                                        lineWidth: 1
                                    }
                                },
                                fillColor: {
                                    linearGradient: {
                                        x1: 0,
                                        y1: 0,
                                        x2: 0,
                                        y2: 1
                                    },
                                    stops: [[0, '#3e85c5'], [1, 'rgba(11, 232, 250, 0)']]
                                }
                            }]
                        });
                    }
                });
            }

            if (id == "equityIntraGraph") {
                setTimeout(function () {
                    $('#' + id).attr({ "role": 'img', "aria-label": 'Pre-open and Intraday price Chart of ' + graphSymbol });
                }, 2000);
            } else if (id.startsWith("currencyAllContracts")) {
                setTimeout(function () {
                    $('#' + id).attr({ "role": 'img', "aria-label": 'Intraday price Chart of ' + data.identifier + ' Contract' });
                }, 2000);
            } else if (id.startsWith("quoteIRFChart")) {
                setTimeout(function () {
                    $('#' + id).attr({ "role": 'img', "aria-label": 'Intraday price Chart of ' + data.identifier + ' Contract' });
                }, 2000);
            } else if (id.startsWith("quoteDerCont")) {
                setTimeout(function () {
                    $('#' + id).attr({ "role": 'img', "aria-label": 'Intraday price Chart of ' + data.identifier + ' Contract' });
                }, 2000);
            } else {
                var graphTxt = 'Chart of Pre open ' + data.identifier + ' vs ' + data.identifier + ' indices data.The extended description is in the view data table option of the chart menu.';
                setTimeout(function () {
                    $('#' + id).attr({ "role": 'img', "aria-label": graphTxt });
                }, 1000);
            }
        });
    } catch (error) {
        console.log("generateChart", error.message);
    }
}

function generateTwoPaneChart(api, id) {
    try {
        $.getJSON(api, function (data) {
            // Create the chart
            if (data) {
                Highcharts.stockChart(id, {
                    rangeSelector: {
                        enabled: false,
                        selected: 1,
                        inputEnabled: false
                    },
                    credits: {
                        enabled: false
                    },
                    title: false,
                    navigator: {
                        enabled: false
                    },
                    scrollbar: {
                        enabled: false
                    },
                    xAxis: {
                        type: 'datetime'
                    },
                    yAxis: [{
                        gridLineWidth: 0,
                        minorGridLineWidth: 0,
                        plotLines: [{
                            color: '#333',
                            width: 1,
                            value: data.closePrice
                        }],
                        labels: {
                            align: 'left'
                        },
                        height: '80%',
                        resize: {
                            enabled: true
                        }
                    }, {
                        labels: {
                            align: 'left'
                        },
                        top: '80%',
                        height: '20%',
                        offset: 0
                    }],
                    tooltip: {
                        shape: 'square',
                        headerShape: 'callout',
                        borderWidth: 0,
                        shadow: false,
                        positioner: function positioner(width, height, point) {
                            var chart = this.chart,
                                position;

                            if (point.isHeader) {
                                position = {
                                    x: Math.max(
                                    // Left side limit
                                    chart.plotLeft, Math.min(point.plotX + chart.plotLeft - width / 2,
                                    // Right side limit
                                    chart.chartWidth - width - chart.marginRight)),
                                    y: point.plotY
                                };
                            } else {
                                position = {
                                    x: point.series.chart.plotLeft,
                                    y: point.series.yAxis.top - chart.plotTop
                                };
                            }

                            return position;
                        }
                    },
                    series: [{
                        type: 'line',
                        id: 'line',
                        name: 'Stock Price',
                        data: data.grapthData

                    }, {
                        type: 'column',
                        id: 'volume',
                        name: 'Volume',
                        data: data.grapthData,
                        yAxis: 1
                    }],
                    responsive: {
                        rules: [{
                            condition: {
                                maxWidth: 800
                            },
                            chartOptions: {
                                rangeSelector: {
                                    inputEnabled: false
                                }
                            }
                        }]
                    }
                });
            }
        });
    } catch (error) {
        console.log("generateChart", error.message);
    }
}

function generatePreopenChart(api, id, checkDownload) {
    try {
        var preOpenDate = new Date();
        preOpenDate = preOpenDate.setHours(8, 30, 0, 0);
        $.getJSON(api, function (preOpenData) {
            if (preOpenData) {
                var _data = void 0;
                try {
                    _data = JSON.parse(preOpenData.grapthData);
                } catch (e) {
                    _data = preOpenData.grapthData;
                }
                _data = _data.sort(function (a, b) {
                    return a[0] - b[0];
                });

                Highcharts.stockChart(id, {
                    rangeSelector: {
                        enabled: false,
                        selected: 1,
                        inputEnabled: false
                    },
                    credits: {
                        enabled: false
                    },
                    title: false,
                    navigator: {
                        enabled: false
                    },
                    scrollbar: {
                        enabled: false
                    },
                    xAxis: {
                        type: 'datetime'
                    },
                    yAxis: {
                        gridLineWidth: 0,
                        minorGridLineWidth: 0,
                        opposite: false,
                        plotLines: [{
                            color: '#333',
                            width: 1,
                            value: preOpenData.closePrice
                        }]
                    },
                    exporting: { enabled: checkDownload ? false : true },
                    series: [{
                        name: preOpenData.identifier || "",
                        data: _data || [],
                        type: 'area',
                        //softThreshold:false,
                        //threshold: 'closePrice',
                        threshold: null,
                        tooltip: {
                            valueDecimals: 2
                        },
                        /*zones: [{
                            value: data.closePrice,
                            color: 'red'
                        }, {
                            color: 'green'
                        }],*/
                        zones: [{
                            value: preOpenDate,
                            color: 'orange',
                            fillColor: {
                                linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
                                stops: [[0, '#FFDCAB'], // start
                                [1, '#fff'] // end
                                ]
                            }
                        }],
                        plotOptions: {
                            series: {
                                color: '#3e85c5',
                                lineWidth: 1
                            }
                        },
                        fillColor: {
                            linearGradient: {
                                x1: 0,
                                y1: 0,
                                x2: 0,
                                y2: 1
                            },
                            stops: [[0, '#3e85c5'], [1, 'rgba(11, 232, 250, 0)']]
                        } }]
                });
            }
            var graphTxt = ' Intraday price chart of ' + preOpenData.identifier + '. The extended description is in the view data table option of the chart menu.';
            setTimeout(function () {
                $('#' + id).attr({ "role": 'img', "aria-label": graphTxt });
            }, 2000);
        });
    } catch (error) {
        console.log("generateChart", error.message);
    }
}

//chart function for intraday live multiple sessions

var currentTimestamp = new Date().getTime();
var timestamp1 = new Date('2024-05-18 09:07:00').getTime();
var timestamp2 = new Date('2024-05-21 09:07:00').getTime();

$(function () {
    if ($("#container").length > 0) {}

    if ($('input[type="range"]').length && !$('input.stream-range')) {
        initRangeSlider('input[type="range"]');
    }
});

function initRangeSlider(elem) {
    var DefaultVal = $('.rangeslider .rangeslider__handle').css('left');
    $(elem).rangeslider({
        polyfill: false,
        rangeClass: 'rangeslider',
        disabledClass: 'rangeslider--disabled',
        horizontalClass: 'rangeslider--horizontal',
        fillClass: 'rangeslider__fill',
        handleClass: 'rangeslider__handle',
        startEvent: ["mousemove", "touchstart", "pointerdown"],
        moveEvent: [],
        endEvent: ["mouseleave", "touchend", "pointerup"],

        onInit: function onInit() {
            var $rangeEl = this.$range;

            // add value label to handle
            var $handle = $rangeEl.find('.rangeslider__handle');
            var handleValue = '<div class="rangeslider__handle__value">' + DecimalFixed(this.value) + '</div>';

            var fixPoint = '<div class="rangeslider_fix">|</div>';
            $rangeEl.append(fixPoint);
            $rangeEl.append(handleValue);
            var leftCss = parseInt($rangeEl.find('.rangeslider__handle').css("left")) - $('.rangeslider__handle__value').outerWidth() / 2;
            $rangeEl.find('.rangeslider__handle__value').css('left', leftCss);
            $rangeEl.find('.rangeslider_fix').css({
                position: 'absolute',
                left: $rangeEl.find('.rangeslider__handle').css("left"),
                display: 'none'
            });
            var rangeLabels = this.$element.attr('labels');
            if (typeof rangeLabels !== 'undefined') {
                rangeLabels = rangeLabels.split(', ');
                $rangeEl.append('<div class="rangeslider__labels"></div>');
                $(rangeLabels).each(function (index, value) {
                    $rangeEl.find('.rangeslider__labels').append('<span class="rangeslider__labels__label">' + value + '</span>');
                });
            }
            //Disable range
            $rangeEl.addClass('rangeslider--disabled');
        },
        onSlide: function onSlide(position, value) {
            var $rangeEl = this.$range;
            var $handle = this.$range.find('.rangeslider__handle__value');
            $handle.text(DecimalFixed(this.value));
            $rangeEl.find('.rangeslider_fix').show();
            $rangeEl.find('.rangeslider__handle').css({
                left: position,
                opacity: 0
            });
            var labelWidth = $rangeEl.find('.rangeslider__handle__value').outerWidth() / 2;
            $rangeEl.find('.rangeslider__handle__value').css('left', position - labelWidth);
        },
        onSlideEnd: function onSlideEnd(position, value) {}
    });
}

/* end chart */
/*
function customDropdown() {
    /!* custom select *!/

    $('.related-select select, .bulk-select select').each(function each() {
        if ($(this).parents('.select').length === 0) {
            var $this = $(this);
            var numberOfOptions = $(this).children('option').length;
            $this.addClass('select-hidden');
            $this.wrap('<div class="select"></div>');
            $this.after('<div class="select-styled">Select Index</div>');

            var $styledSelect = $this.next('div.select-styled');
            //$styledSelect.text($this.children('option').eq(0).text());
            var $list = $('<ul />', {
                'class': 'select-options'
            }).insertAfter($styledSelect);

            for (var i = 0; i < numberOfOptions; i++) {
                var escapedText = escapeHtml($this.children('option').eq(i).text());
                $('<li rel="' + escapedText + '">' + escapedText + '</li>').appendTo($list);
            }

            var $listItems = $list.children('li');
            //$list.children('li:first-child').addClass('active');
            $styledSelect.click(function (e) {
                e.stopPropagation();
                $('div.select-styled.active').not(this).each(function () {
                    $(this).removeClass('active').next('ul.select-options').hide();
                });
                $(this).toggleClass('active').next('ul.select-options').toggle();
            });

            $listItems.click(function (e) {
                e.stopPropagation();

                $styledSelect.text($(this).text()).removeClass('active');

                $this.val($(this).attr('rel')).attr('selected', 'selected');
                $list.hide();
                if ($styledSelect.text() == $(this).text()) {
                    $listItems.removeClass('active');
                    $(this).addClass('active');
                    var getindex = $(this).parents('.related-select').index();
                    $('.tab-pane.active').find('.dropdown-Wrap .dropdown-content').eq(getindex).addClass('active').siblings().removeClass('active');
                    $('.tab-pane.active').find('.plusbtn').removeClass('closebtn');
                    $(this).parents('.related-select').find('.tabspan').text($(this).text());
                }
            });

            $(document).click(function () {
                $styledSelect.removeClass('active');
                $list.hide();
            });
        }
    });
}*/

$(function () {
    var checkedArrey = [];
    var dropcount = 1;
    var _droplist, _dropData, getid;
    checkAlertBandCookie();
    $('.plusbtn').click(function (event) {
        event.preventDefault();
        event.stopPropagation();

        if (!$(this).hasClass('closebtn')) {
            dropcount++;
            _dropData = "";
            _droplist = $(this).parent('.head_selectbox').find('.custom_select').eq(0).find('select').html();
            _dropData = '<div><label  id="liveMrktStockSelLbl' + dropcount + '">Category ' + dropcount + '</label><div class="custom_select" class="no-border-radius" id="create' + dropcount + '"><select aria-labelledby="liveMrktStockSelLbl' + dropcount + '" class="no-border-radius" data-no="' + dropcount + '"><option value="-1"><span id="index0Lbl">Select Index</span></option>' + _droplist + '</select></div><div>';
            getid = '#create' + dropcount + '';

            if (dropcount == 5) {
                $(this).hide();
            }
            if (dropcount <= 5) {
                $(_dropData).insertBefore($(this));
                $(getid).find('option:selected').removeAttr('selected');
                // $(getid).find('select').click();
                $(this).parents(".head_selectbox").find('.custom_select').each(function () {

                    if ($(this).find(".tabspan").length == 0) {
                        var newDiv = '<span class="tabspan" data-val=""></span>';
                        $(this).append(newDiv);
                    }
                    $(this).find(".tabspan").text($(this).find("select option:selected").text());
                    $(this).find(".tabspan").attr('data-val', $(this).find("select").val());
                });
                $('.head_selectbox .custom_select').eq(dropcount - 2).find('.tabspan').addClass('active');

                $(this).addClass('closebtn');
                $(this).find('a').attr('title', 'Remove new Category Tab');
                $(this).find('a').attr('aria-label', 'Remove new Category Tab');
            }
        } else {
            dropcount--;
            $(this).removeClass('closebtn');
            $(this).find('a').attr('title', 'Add a new Category Tab');
            $(this).find('a').attr('aria-label', 'Add a new Category Tab');
            $(this).prev().remove();
            $(this).prev().find('.tabspan').removeClass('active');
        }
    });

    $(document)
    /*.on("click", ".head_selectbox .custom_select select", function (event) {
        if ($(this).data('no') !== activeTabNo) {
            event.preventDefault();
            event.stopPropagation();
            $(this).trigger('change');
        }
    })*/
    .on("change", ".head_selectbox .custom_select select", function (event) {
        event.preventDefault();
        event.stopPropagation();

        var getval = $(this).parents('.custom_select').find('select').val();
        if (getval !== -1) {
            $(this).parents('.head_selectbox').find('.plusbtn').removeClass('closebtn');
            var tabLen = $(this).parents('.head_selectbox').find('.custom_select').length - 1;
            $(this).parents('.head_selectbox').find('.custom_select').each(function (index) {
                if (index < tabLen && !$(this).hasClass('custom_close')) {
                    $(this).addClass("custom_close");
                    $(this).append('<span class="tabClose"><span class="close_icon"></span></span>');
                    $(this).append('<span class="activeTab"></span>');
                }
            });

            var _getval = $(this).parents('.custom_select').find('option:selected').val();
            var getText = $(this).parents('.custom_select').find('select option:selected').text();
            var getRel = $(this).parents('.custom_select').find('select option:selected').attr('rel');
            $(this).parents('.custom_select').find('.tabspan').attr({ "data-val": _getval, "data-rel": getRel }).text(getText);
            activeTabVal = _getval;
            updateMarketData(_getval, getRel);
            activeTabNo = $(this).data('no');
        } else {
            //$(this).parents('.head_selectbox').find('.plusbtn').addClass('closebtn');
        }
    });

    $('.selectbox').on('click', '.activeTab', function () {
        if ($('.head_selectbox .closebtn').length > 0) {
            alert("Select Indicies");
        } else {
            var _parent = $(this).parent();
            var _this = $(this);
            _this.remove();
            _parent.find('.tabClose').remove();
            _parent.removeClass('custom_close').siblings('.custom_select').addClass('custom_close');
            var activeVal = _parent.find('select option:selected').val();
            var activeType = $('.head_selectbox').data('type');
            updateMarketData(activeVal, activeType);

            $('.head_selectbox').find('.custom_close').each(function (index) {
                if ($(this).find('.tabClose').length === 0) {
                    $(this).append('<span class="tabClose"><span class="close_icon"></span></span>');
                }
                if ($(this).find('.activeTab').length === 0) {
                    $(this).append('<span class="activeTab"></span>');
                }
            });
            activeTabVal = activeVal;
        }
    });
    $('.selectbox').on('click', '.tabClose', function () {
        if ($('.head_selectbox .closebtn').length > 0) {
            alert("Select Indicies");
        } else if ($(this).parent().parent()[0] === $(".head_selectbox").children()[0]) {
            // check if first tab clicked then do not allow to close the tab
            alert("First index can not be removed");
        } else {
            $(this).parent().remove();
            $('.head_selectbox .plusbtn').show();
            dropcount--;
        }
    });

    /*$(document).on("click", ".tabspan", function () {
        let getValue = $(this).attr('data-val');
        let getRel = $(this).attr('data-rel');
        $(this).parents('.custom_select').find('select').val(getValue).click();
          $(this).parents('.custom_select').find('.tabspan').removeClass('active');
        $(this).parents('.custom_select').siblings().find('.tabspan').addClass('active');
          updateMarketData(getValue, getRel);
    })*/

    var checkedCheckboxLength = 5;
    $('#selectIndicesModal .modal-body').find('input[type=checkbox]').change(function () {
        // if($(this).is(":checked")){
        //     var thisText = $(this).parent().text().trim(" ")
        //     checkedArrey.push(thisText);
        // }
        checkedCheckboxLength = $('#selectIndicesModal .modal-body').find('input[type=checkbox]:checked').length;
        var limit = 5;
        if (checkedCheckboxLength > limit) {
            checkedCheckboxLength = checkedCheckboxLength - 1;
            alert('Select max 5 options');
            this.checked = false;
            $(this).parent('label').attr('aria-checked', false);
        }
    });

    $(document).on('click', '#selectIndicesModal .modal-content .useDefaultBtn', function (e) {
        setCookie("nseIndices", niftyTypes);
        checkedArrey = [];
        $('#selectIndicesModal .modal-body').find('input[type=checkbox]').prop('checked', false);
        $('#selectIndicesModal .modal-body').find('input[type=checkbox]').parent('label').attr('aria-checked', false);
        checkboxesDefaultCheck();
        $(this).closest('.modal-content').find('.modal-header button.close').trigger('click');
        location.reload();
    });

    $(document).on('click', '#selectIndicesModal .modal-content .confirmBtn', function (e) {
        checkedArrey = [];
        $('#selectIndicesModal .modal-body').find('input[type=checkbox]:checked').each(function (e) {
            var thisText = $(this).attr('name');
            checkedArrey.push(thisText);
        });

        if (checkedCheckboxLength == 5) {
            setCookie("nseIndices", checkedArrey);
            $(this).closest('.modal-content').find('.modal-header button.close').trigger('click');
            location.reload();
        } else if (checkedCheckboxLength < 5) {
            alert('Select min 5 options');
        }
    });
});

function updateMarketData(val, type) {
    switch (type) {
        case "equity":
            eqMarketScriptCall = val;
            equitystockIndices.state.rowData = [];
            B.findOne("#equityStockTable .emptyRow").innerHTML = loader;
            if (!!$("#radioCrores_stock")) {
                $("#radioCrores_stock").trigger("click");
            }
            B.get('/api/equity-stockIndices?index=' + encodeURIComponent(val.toUpperCase())).then(function (resp) {
                var resData = JSON.parse(resp);
                equitystockIndices.state.rowData = resData.data || [];
                var mStatus = resData.marketStatus;
                var timeStampMessage = mStatus ? '<span class="' + (mStatus.marketStatusMessage.toLowerCase().includes('open') ? 'cool-green' : 'cool-red') + '" id="' + mStatus.marketStatusMessage + '"> ' + mStatus.marketStatusMessage + ' </span>' : "";
                timeStampMessage += typeof resData.timestamp !== "undefined" ? " As on " + resData.timestamp + " IST" : "";
                if (timeStampMessage) B.findOne("#liveMrkStockTime").innerHTML = timeStampMessage;
                B.findOne("#liveMrkStockAdv").innerText = resData.advance.advances || 0;
                B.findOne("#liveMrkStockDec").innerText = resData.advance.declines || 0;
                B.findOne("#liveMrkStockUnChng").innerText = resData.advance.unchanged || 0;
            });
            break;
        case "derivatives":
            updateEquityDerivative(val);
            break;
    }
}

/*Fixed Decimal Start*/

//Eg:DecimalFixed(valpass)
function formatPercentage(val) {
    var localeString = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'en-IN';

    var absValue = Math.abs(val);
    var returnString = Number(absValue).toLocaleString(localeString);
    return val < 0 ? '-' + returnString : returnString;
}

function DecimalFixed(val) {
    var noDecimal = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
    var escapeHypen = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
    var digits = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 2;
    var localeString = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 'en-IN';

    val = parseFloat(val) || 0;
    var num = val === 0 && !escapeHypen ? '-' : val.toLocaleString(localeString, {
        minimumFractionDigits: noDecimal ? 0 : digits,
        maximumFractionDigits: noDecimal ? 0 : digits
    });
    return num;
}

function CurrDecimalFixed(val) {
    var digits = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 4;
    var localeString = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'en-IN';

    val = parseFloat(val) || 0;
    var num = val === 0 ? '-' : val.toLocaleString(localeString, {
        minimumFractionDigits: digits,
        maximumFractionDigits: digits
    });
    return num;
}
/*Fixed Decimal Start End*/

// Search Page

function gotoSearchPage() {
    try {
        setTimeout(function () {
            var currentVal = parseInt($('#resultPageNo').val());
            var q = getParameterByName('q');
            var page = getParameterByName('page');
            var type = getParameterByName('type');
            if (currentVal > parseInt($('#totalPages').text())) {
                currentVal = parseInt($('#totalPages').text());
            }
            if (currentVal <= 0) {
                currentVal = 1;
            }
            if (page === null) {
                page = 1;
            }
            if (parseInt(page) !== parseInt(currentVal)) {
                var params = void 0;
                if (page !== null && type !== null) {
                    params = { 'q': q, 'page': currentVal, 'type': type };
                }
                if (page && type === null || page === null) {
                    params = { 'q': q, 'page': currentVal };
                }
                if (page === null && type) {
                    params = { 'q': q, 'type': type };
                }

                var new_url = '/search?' + jQuery.param(params);
                window.location.href = new_url;
            }
        }, 300);
    } catch (e) {
        console.log(e);
    }
}
function isNumber(evt) {
    evt = evt ? evt : window.event;
    var charCode = evt.which ? evt.which : evt.keyCode;
    if (charCode > 31 && (charCode < 48 || charCode > 57)) {
        return false;
    }
    return true;
}

function onlyNumberKey(evt) {
    // Only ASCII charactar in that range allowed
    var ASCIICode = evt.which ? evt.which : evt.keyCode;
    if (ASCIICode > 31 && (ASCIICode < 48 || ASCIICode > 57)) return false;
    return true;
}

function getHostname(url) {
    var hostname;
    if (url.indexOf("//") > -1) {
        hostname = url.split('/')[2];
    } else {
        hostname = url.split('/')[0];
    }
    hostname = hostname.split(':')[0];
    hostname = hostname.split('?')[0];

    return hostname;
}

B.on(document, 'allGood', function () {
    $(function () {
        $('a').on("click", function (e) {
            if (!e.isTrigger && this.href && this.href !== 'javascript:;' && !this.href.includes('javascript') && !this.href.includes('#') && !this.href.includes('www1') && !this.href.includes('static') && !this.href.includes('data') && !this.href.includes('archives')) {
                if (getHostname(this.href) !== getHostname(window.location.host)) {
                    if (!ignoreDisclaimer.includes(this.href)) {
                        var exitMsg = 'You are about to leave the Website of the National Stock Exchange of India Limited (NSE).\nYou have selected a link that will take you away from the NSE website.  This site may be maintained by an entity other than NSE or its Group Companies. NSE is not responsible for the content of the web site you are visiting from the selected link.\nYou are aware and you expressly acknowledge and agree that the linked site may not be under the control of NSE and NSE is shall not be responsible for the contents of such site or any link contained in such site, or any changes or updates to such web site. NSE shall not be responsible or liable in manner whatsoever for any payments that you make for any services that you may avail from such website or the selected link.\nNSE is not responsible for the accuracy, appropriateness or the reliability of the data or content available on the website you are visiting from the selected link.  Unless expressly mentioned, NSE does not endorse any views, data and/or content available on the selected website.\nOnce you visit the website from the selected link, the policies/terms/conditions of such selected website may be applicable on you.\nThe availability of this link on the NSE website shall not be construed as advertisement and/or endorsement of such website by NSE in any manner whatsoever.\nIf you decide to visit such site, you agree and acknowledge do so at your own risk and it is your responsibility to take all protective measures to guard against viruses or any other destructive elements that you may encounter.\nBy clicking on the CONTINUE button below, you acknowledge the above mentioned statement and you will be taken to the linked site. If you want to remain at this site, select the CANCEL button.\n';
                        //let res = confirm("Are you sure you want to exit?");
                        var res = confirm(exitMsg);
                        if (!res) {
                            e.preventDefault();
                            e.stopPropagation();
                        }
                    }
                }
            }
        });
    });

    //Footer Copyright year
    var currentD = new Date();
    var currentY = currentD.getFullYear();
    $('#copyrightYear').text(currentY);

    //Search GO TO Page
    $('#resultPageNo').keyup(function () {
        gotoSearchPage();
    });
    $('#resultPageNo').change(function () {
        gotoSearchPage();
    });
    // autoplayMarketStatus();
    //marketStatusSlick(); // now in slick carousel
    updateMarketStatus();
    derivativeStatusSlick();
    // generateCSRF();
    if ($("#TabMenu").length > 0) {
        $('.tab-menu').responsiveTabs();
    }

    if (getCookie("nseIndices") !== null) {
        var getCookieVal = getCookie("nseIndices");
        var convertCookieArray = getCookieVal.split(',');
        for (var i = 0; i <= convertCookieArray.length; i++) {
            $('#selectIndicesModal .modal-body').find('input[name="' + convertCookieArray[i] + '"]').prop('checked', true);
            $('#selectIndicesModal .modal-body').find('input[name="' + convertCookieArray[i] + '"]').parent('label').attr('aria-checked', true);
        }
    } else {
        checkboxesDefaultCheck();
    }
    if (document.getElementById('tab1_container') !== null) {
        var convertCookieArray;
        if (getCookie("nseIndices") !== null) {
            var getCookieVal = getCookie("nseIndices");
            convertCookieArray = getCookieVal.split(',');
        } else {
            convertCookieArray = niftyTypes;
        }

        B.get('/api/regulatorymodulestatus').then(function async(resp) {
            var respJSON = JSON.parse(resp);
            var checkDynamicCharts = "true";
            if (respJSON && respJSON.data) {
                if (respJSON.data.index_equity_graph === "false") {
                    checkDynamicCharts = "false";
                } else {
                    checkDynamicCharts = "true";
                }
                return checkDynamicCharts;
            }
        }).then(function (checkDynamicCharts) {
            for (var i = 0; i < convertCookieArray.length; i++) {
                if (checkDynamicCharts === "true") {
                    dynamicGenerateHomeChart('/api/chart-databyindex-dynamic?index=' + encodeURIComponent(convertCookieArray[i]) + '&indices=true', 'tab' + (i + 1) + '_container');
                } else {
                    generateHomeChart('/api/chart-databyindex?index=' + encodeURIComponent(convertCookieArray[i]) + '&indices=true', 'tab' + (i + 1) + '_container');
                }
            }
        });
    }

    $('.nse_academy').find('.play_pause_btn').on('click', function (e) {
        if ($(this).html() == '<i class="fa fa-pause-circle"></i>') {
            $('.academy_slider').slick('slickPause');
            $(this).html('<i class="fa fa-play-circle"></i>');
        } else {
            $('.academy_slider').slick('slickPlay');
            $(this).html('<i class="fa fa-pause-circle"></i>');
        }
        e.preventDefault();
    });
    /* end home hero slider */

    /* academic slider */
    $('.academy_slider').slick({
        dots: true,
        infinite: false,
        speed: 300,
        slidesToShow: 1,
        autoplay: true,
        autoplaySpeed: 4000,
        slidesToScroll: 1,
        arrows: false
    });
    /* end academic slider */
    if ($("#corporate-videos").length > 0) {
        $("#corporate-videos .youTubeImg").each(function () {
            var youtubeId = getParameterByName("v", $(this).attr('rel'));
            $(this).attr('src', 'https://img.youtube.com/vi/' + youtubeId + '/mqdefault.jpg');
        });
    }

    if ($("#currencySpotRate").length > 0) {
        $("#currencySpotRate .currSymbol").each(function () {
            var currSymbol = getCurrencySymbol($(this).attr('rel'));
            $(this).text(currSymbol + " " + $(this).text());
        });
    }

    $('.todayDate').text(dateFormat(new Date()));
    var days = 1;
    $('.nextDate').text(dateFormat(new Date(Date.now() + days * 24 * 60 * 60 * 1000)));

    // read hash from page load and change tab
    var hash = document.location.hash;
    var prefix = "tab_";
    if (hash) {
        $('.nav-tabs a[href="' + hash + '"]').tab('show');
        $('.nav-tabs a[href="' + hash + '"]').parents('.card').find('.card-header a').click();
    }
    /* @end goto specific tab */
    var tabName = getParameterByName('tab');
    if (tabName !== null) {
        $('.nav-link').each(function () {
            if ($(this).attr('href').replace('#', '') === tabName) {
                $(this).click();
            }
        });
    }

    /* learn landing hero slider */
    if ($('.learn_hero_slider').length && $('.learn_hero_slider .item').length > 1) {
        $('.learn_hero_slider').slick({
            dots: true,
            infinite: false,
            speed: 300,
            slidesToShow: 1,
            slidesToScroll: 1,
            arrows: false
        });
    }
    /* @end learn landing hero slider */

    /* common slider */
    if ($('.common_slider').length && ($('.learn_hero_slider .item').length > 1 || $('#learn_categories .item').length > 1)) {
        $('.common_slider').slick({
            dots: true,
            infinite: false,
            speed: 300,
            slidesToShow: 4,
            slidesToScroll: 1,
            arrows: false,
            responsive: [{
                breakpoint: 1024,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 1,
                    infinite: true

                }
            }, {
                breakpoint: 600,
                settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1
                }
            }, {
                breakpoint: 480,
                settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1
                }
            }]
        });
    }

    /* event slider */
    if ($('.slider-for').length) {
        $('.slider-for').slick({
            slidesToShow: 1,
            slidesToScroll: 1,
            arrows: true,
            fade: true,
            asNavFor: '.slider-nav'
        });
        $('.slider-nav').slick({
            slidesToShow: 5,
            slidesToScroll: 5,
            asNavFor: '.slider-for',
            arrows: false,
            dots: true,
            centerMode: true,
            focusOnSelect: true,
            responsive: [{
                breakpoint: 1024,
                settings: {
                    slidesToShow: 4,
                    slidesToScroll: 4
                }
            }, {
                breakpoint: 600,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 3
                }
            }, {
                breakpoint: 480,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 2
                }
            }]
        });

        $('.slider-for').on('init', function (event, slick) {}).on('afterChange', function (e, o) {
            $('iframe').each(function () {
                $(this)[0].contentWindow.postMessage('{"event":"command","func":"' + 'stopVideo' + '","args":""}', '*');
            });
        }).slick();
    }
    /* @end event slider */

    function loadMarketTurnover() {
        //$('#derRatio').text('');
        $('#marketTurnover>tbody').empty();
        var marketTurnOverRadio = $("#radio_marketTurnOver").find("input:checked").val();
        if (marketTurnOverRadio === 'billions') {
            $("#radioBillions_marketTurnOver").prop("checked", true);
        } else {
            $("#radioCrores_marketTurnOver").prop("checked", true);
        }
        B.get('/json/market-turnover-popup.json').then(function (resp) {
            var respJSON = JSON.parse(resp);
            tablemarketTurnover = customTableNoHead({
                tableStyle: { class: '' },
                colData: respJSON.columns || [],
                rowData: [],
                marketturnover: 1
            });
            B.render(tablemarketTurnover, B.findOne('#marketTurnover'));
            B.findOne("#marketTurnover .emptyRow").innerHTML = loader;
            B.get("/api/market-turnover-popup").then(function (resp) {
                var resData = JSON.parse(resp);
                tablemarketTurnover.state.rowData = resData.data || [];
                B.findOne("#liveindexTime").innerHTML = resData.currentDate && typeof resData.currentDate !== "undefined" ? '<span id="asontxt"> As on </span> <span dir="ltr"> ' + resData.currentDate + ' </span>' : "-";
                //$('#derRatio').text(resData.derivativeToCashRatio);
                var nsetranslateEvent = new CustomEvent('element_render_end_custom_event');
                $('#marketTurnover tbody tr td span').each(function () {
                    $(this).closest('tr').find('td').css({ 'font-weight': 'bold', 'color': '#3a2d7d' });
                    $(this).closest('tr').css('background', '#3b2e7d0d');
                    $(this).closest('td').css('background', '#F5F4F8');
                });
                document.dispatchEvent(nsetranslateEvent);
            });
        });
    }

    function marketTurnOverPopupVal() {
        $("#radio_marketTurnOver").on("change", "input", function () {
            var selVal = $("#radio_marketTurnOver").find("input:checked").val();
            switch (selVal.toLowerCase()) {
                case "lakhs":
                    $('#marketTurnover').find('.updateCurrType').text('(₹ Lakhs)');
                    $('#marketTurnover').find('.updateCurrType').attr('data-nse-translate-currencyunit', 'lakhs');
                    break;
                case "billions":
                    $('#marketTurnover').find('.updateCurrType').text('(₹ Billions)');
                    $('#marketTurnover').find('.updateCurrType').attr('data-nse-translate-currencyunit', 'billions');
                    break;
                case "crores":
                    $('#marketTurnover').find('.updateCurrType').text('(₹ Crores)');
                    $('#marketTurnover').find('.updateCurrType').attr('data-nse-translate-currencyunit', 'crores');
                    break;
            }
            convertToValue(selVal, tablemarketTurnover);
            $('#marketTurnover tbody tr td span').each(function () {
                $(this).closest('tr').find('td').css({ 'font-weight': 'bold', 'color': '#3a2d7d' });
                $(this).closest('tr').css('background', '#3b2e7d0d');
                $(this).closest('td').css('background', '#F5F4F8');
            });
            var nsetranslateEvent = new CustomEvent('element_render_end_custom_event', {
                detail: {
                    name: 'marketTurnoverContainer',
                    ancestorId: 'marketTurnoverContainer'
                } });
            document.dispatchEvent(nsetranslateEvent);
        });
        var nsetranslateEvent = new CustomEvent('element_render_end_custom_event', {
            detail: {
                name: 'marketTurnoverContainer',
                ancestorId: 'marketTurnoverContainer'
            }
        });
        document.dispatchEvent(nsetranslateEvent);
    }
    $("#radio_marketTurnOver").on("change", "input", marketTurnOverPopupVal);
    $(".mt-detail-view").on("click", loadMarketTurnover);
    $(".refreshmarketTurnOverPopup").on("click", refreshmarketTurnOver);
    checkActivitySetup();
    connectWebsocket();
});

// Default check checkboxes
function checkboxesDefaultCheck() {
    $('#selectIndicesModal .modal-body .chk_container').each(function (e) {
        var inputName = $(this).find('input').attr('name');
        if (niftyTypes.indexOf(inputName) >= 0) {
            for (var i = 0; i <= niftyTypes.length; i++) {
                $(this).find('input[name="' + niftyTypes[i] + '"]').prop('checked', true);
                $(this).find('input[name="' + niftyTypes[i] + '"]').parent('label').attr('aria-checked', true);
            }
        }
    });
}

function setCookie(name, value, days) {
    var expires = "";
    if (days) {
        var date = new Date();
        date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
        expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "") + expires + "; path=/";
}

function getCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1, c.length);
        }if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
}

function corporateSlider(id) {
    try {
        /* corporate slider */
        $(id).slick({
            dots: true,
            infinite: false,
            speed: 300,
            slidesToShow: 4,
            slidesToScroll: 4,
            arrows: false,
            responsive: [{
                breakpoint: 1024,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 2,
                    infinite: true

                }
            }, {
                breakpoint: 600,
                settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1
                }
            }, {
                breakpoint: 480,
                settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1
                }
            }]
        });
        /* end corporate slider */
    } catch (error) {
        console.log("corporateSlider", error.message);
    }
}

/* Download Table to CSV */
function download_csv(csv, filename, id, _this) {
    if (navigator.msSaveBlob) {
        // IE 10+
        var fileName = filename + ".csv";
        var blob = new Blob([csv], {
            "type": "text/csv;charset=utf8;"
        });
        navigator.msSaveBlob(blob, fileName);
    } else {
        return ExcellentExport.csv(_this, id);
        /*var link = _this;
        var csvdatacontent = "data:text/csv;charset=utf-8," + csv;
        var encodedUri = encodeURI(csvdatacontent);
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", filename+".csv");
        link.click();*/
    }
}

function export_table_to_csv(_this, id, filename, type, limit) {
    var csv = [];
    var _id = '#' + id;
    var rows = document.querySelectorAll(_id + " tr");

    if (rows && rows.length > 0) {
        for (var i = 0; i < rows.length; i++) {
            var row = [],
                cols = rows[i].querySelectorAll("td, th");

            for (var j = 0; j < cols.length; j++) {
                row.push(cols[j].innerText.replace(/[,\r\n]/g, ''));
            }csv.push(row.join(","));
        }
    }
    // Download CSV
    download_csv(csv.join("\r\n"), filename, id, _this);
}

/* End */

function getCurrencySymbol(val) {
    var returnData;
    currencyMap.map(function (item, index) {
        if (item.name === val) {
            returnData = item.value;
        }
    });
    return returnData;
}

function getParameterByName(name, url) {
    try {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        //return decodeURIComponent(results[2].replace(/\+/g, " "));
        return escapeHtml(decodeURIComponent(results[2].replace(/\+/g, " ")), true);
    } catch (error) {
        console.log("getParameterByName", error.message);
    }
}

/* Market Status Animation */
// var boxHeight = $(".top_logomenu .niftyMarket .niftyFifty").outerHeight(true);
// var boxLength = $(".top_logomenu .niftyMarket .niftyFifty").length;
// $(".top_logomenu .niftyMarket .innerContainer").css({
//     'position': 'relative',
//     'height': boxHeight * boxLength
// });

/*function autoplayMarketStatus() {
    clearTimeout(autoPlayMarket);
    if($(".top_logomenu .niftyMarket .innerContainer .niftyFifty").length === 4) {
        var boxClone = $(".top_logomenu .niftyMarket .innerContainer .niftyFifty").eq(0).clone();
        $(".top_logomenu .niftyMarket .innerContainer").animate({
            'top': -boxHeight
        }, 800, function () {
            $(".top_logomenu .niftyMarket .innerContainer .niftyFifty").eq(0).remove();
            $(".top_logomenu .niftyMarket .innerContainer").css({'top': 0}).append(boxClone);
        });
    }
    autoPlayMarket = setTimeout(function () {
        autoplayMarketStatus();
    }, 6000)
}*/

/* End */

function dateFormat(date) {
    var mon = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
    var d = new Date(date),
        month = '' + mon[d.getMonth()],
        day = '' + d.getDate(),
        year = d.getFullYear();

    if (month.length < 2) month = '0' + month;
    if (day.length < 2) day = '0' + day;
    return [day, month, year].join(' ');
}

function dateFormat2(date) {
    var d = new Date(date),
        month = '' + (d.getMonth() + 1),
        day = '' + d.getDate(),
        year = d.getFullYear();
    if (month.length < 2) month = '0' + month;
    if (day.length < 2) day = '0' + day;
    return [day, month, year].join('-');
}

function eventdateFormat2(date) {
    var mon = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
    if (date === '' || date === null || date === undefined) {
        return '';
    }
    var d = new Date(date);
    if (isNaN(d.getTime())) {
        return '';
    }
    var day = String(d.getDate()).padStart(2, '0');
    var month = mon[d.getMonth()];
    var year = d.getFullYear();
    return day + '-' + month + '-' + year;
}

function genGraph(id, row) {
    try {
        setTimeout(function () {
            Highcharts.stockChart(id, {
                rangeSelector: {
                    enabled: false,
                    selected: 1,
                    inputEnabled: false
                },
                credits: {
                    enabled: false
                },
                chart: {
                    backgroundColor: 'transparent',
                    height: 60,
                    width: 100
                },
                title: false,
                navigator: {
                    enabled: false
                },
                scrollbar: {
                    enabled: false
                },
                yAxis: {
                    gridLineWidth: 0,
                    minorGridLineWidth: 0,
                    opposite: false,
                    labels: {
                        enabled: false
                    }
                },
                xAxis: {
                    lineWidth: 0,
                    minorGridLineWidth: 0,
                    lineColor: 'transparent',
                    labels: {
                        enabled: false
                    },
                    minorTickLength: 0,
                    tickLength: 0
                },
                exporting: { enabled: false },
                tooltip: {
                    enabled: false
                },
                series: [{
                    name: 'Nifty fifty',
                    data: row,
                    type: 'area',
                    threshold: null,
                    fillColor: {
                        linearGradient: {
                            x1: 0,
                            y1: 0,
                            x2: 0,
                            y2: 1
                        },
                        stops: [[0, '#3e85c5'], [1, 'rgba(11, 232, 250, 0)']]
                    },
                    plotOptions: {
                        series: {
                            color: '#3e85c5',
                            lineWidth: 1
                        }
                    }
                }]
            });
        }, 50);
    } catch (error) {
        console.log("genGraph", error.message);
    }
}

function filterInputVal(section, val) {
    try {
        switch (section) {
            case "IPPPastIssue":
                if (val.length < 3) {
                    liveIPPpast.state.rowData = liveIPPpastRD;
                } else {
                    var filterData = liveIPPpastRD.filter(function (liveIPPpastRD) {
                        return liveIPPpastRD.company.toLowerCase().indexOf(val.toLowerCase()) >= 0;
                    });
                    liveIPPpast.state.rowData = filterData;
                }
                break;

            case "TenderPastIssue":
                if (val.length < 3) {
                    liveTenderpast.state.rowData = liveTenderpastRD;
                } else {
                    var _filterData = liveTenderpastRD.filter(function (liveTenderpastRD) {
                        return liveTenderpastRD.company.toLowerCase().indexOf(val.toLowerCase()) >= 0;
                    });
                    liveTenderpast.state.rowData = _filterData;
                }
                break;

            case "RitsPastIssue":
                if (val.length < 3) {
                    liveRitsPast.state.rowData = liveRitsPastRD;
                } else {
                    var _filterData2 = liveRitsPastRD.filter(function (liveRitsPastRD) {
                        return liveRitsPastRD.company.toLowerCase().indexOf(val.toLowerCase()) >= 0;
                    });
                    liveRitsPast.state.rowData = _filterData2;
                }
                break;

            case "OfsPastRetail":
                if (val.length < 3) {
                    liveOfsPastRetail.state.rowData = liveOfsPastRetailRD;
                } else {
                    var _filterData3 = liveOfsPastRetailRD.filter(function (liveOfsPastRetailRD) {
                        return liveOfsPastRetailRD.companyName.toLowerCase().indexOf(val.toLowerCase()) >= 0;
                    });
                    liveOfsPastRetail.state.rowData = _filterData3;
                }
                break;

            case "OfsPastGeneral":
                if (val.length < 3) {
                    liveOfsPastGeneral.state.rowData = liveOfsPastGeneralRD;
                } else {
                    var _filterData4 = liveOfsPastGeneralRD.filter(function (liveOfsPastGeneralRD) {
                        return liveOfsPastGeneralRD.companyName.toLowerCase().indexOf(val.toLowerCase()) >= 0;
                    });
                    liveOfsPastGeneral.state.rowData = _filterData4;
                }
                break;

            case "OfsPast":
                if (val.length < 3) {
                    liveOfsPast.state.rowData = liveOfsPastRD;
                } else {
                    var _filterData5 = liveOfsPastRD.filter(function (liveOfsPastRD) {
                        return liveOfsPastRD.companyName.toLowerCase().indexOf(val.toLowerCase()) >= 0;
                    });
                    liveOfsPast.state.rowData = _filterData5;
                }
                break;
        }
    } catch (error) {
        console.log("filterInputVal ", error.message);
    }
}

// search autocomplete implementation
var headerSearchInput = document.getElementById('header-search-input');
if (headerSearchInput) {
    var autoCompleteSource = new Bloodhound({
        datumTokenizer: Bloodhound.tokenizers.whitespace,
        queryTokenizer: Bloodhound.tokenizers.whitespace,
        remote: {
            url: '/api/search/autocomplete?q=%QUERY',
            wildcard: '%QUERY',
            transform: function transform(response) {
                var symbols = response.symbols,
                    search_content = response.search_content,
                    sitemap = response.sitemap,
                    mfsymbols = response.mfsymbols;

                return [].concat(symbols.slice(0, 5), sitemap.slice(0, 2), symbols.slice(5, symbols.length), mfsymbols, sitemap.slice(2, sitemap.length), search_content);
            }
        }
    });

    $('#header-search-input').typeahead({
        highlight: false,
        hint: false,
        minLength: 2
    }, {
        name: 'search',
        source: autoCompleteSource,
        limit: 7,
        display: 'symbol',
        templates: {
            empty: function empty(data) {
                return '<div class="autocompleteList"><p class="line1"><span>No record found</span></p></div>';
            },
            suggestion: function suggestion(data) {
                if (data) {
                    if (data.result_type === 'sitemap') {
                        return '<div class="autocompleteList">\n                            <p class="line1">\n                                <span class="full">' + data.site_sub_module + '</span>\n                            </p>\n                            <p class="line2">in ' + data.site_module + '</p>\n                        </div>';
                    } else if (data.result_type === 'content') {
                        return '<div class="autocompleteList">\n                            <p class="line1">\n                                <span class="full">' + data.title + '</span>\n                            </p>\n                            <p class="line2">in ' + data.result_sub_type + '</p>\n                        </div>';
                    } else if (data.result_type === 'debt') {
                        return '<div class="autocompleteList">\n                            <p class="line1">\n                                <span class="full">' + data.symbol_info + '</span>\n                            </p>\n                            <p class="line2">in ' + data.result_sub_type + '</p>\n                        </div>';
                    } else {
                        return '<div class="autocompleteList">\n                            <p class="line1">\n                                <span class="lt">' + data.symbol_info + '</span>\n                                <span>' + data.symbol + '</span>\n                            </p>\n                            <p class="line2">in ' + data.result_sub_type + '</p>\n                        </div>';
                    }
                }
            },
            footer: function footer(data) {
                return '<div class="footerNote">Press Enter for more result</div>';
            }
        }
    }).on('typeahead:select', function (event, data) {
        // redirect user to selected item's url
        window.location.href = data.url;
    }).on('typeahead:open', function (event, data) {
        $('#header-search-input').attr('aria-expanded', true);
        $(document).keydown(function (e) {
            if (e.keyCode > 36 && e.keyCode < 41) {
                $('.tt-dataset-search .tt-selectable.tt-cursor').each(function () {
                    var thisVal = $(this).find('.line1 .lt').text();
                    $('#header-search-input').attr('aria-label', thisVal);
                });
            }
        });
    }).on('typeahead:close', function (event, data) {
        $('#header-search-input').attr('aria-expanded', false);
    });

    $('#header-search-input, #page-search-input').on('keypress', function (event) {
        if (event.which === 13) {
            event.preventDefault();

            var q = event.target.value.trim();
            if (!q) {
                return;
            }

            // redirect user to search page
            window.location.href = '/search?q=' + encodeURIComponent(q);
        }
    });
}

var convertToValue = function convertToValue(val, selector) {
    switch (val) {
        case "lakhs":
            for (var _iterator = selector.state.colData, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
                var _ref;

                if (_isArray) {
                    if (_i >= _iterator.length) break;
                    _ref = _iterator[_i++];
                } else {
                    _i = _iterator.next();
                    if (_i.done) break;
                    _ref = _i.value;
                }

                var key = _ref;

                if (key.valueTyp && key.valueTyp > 0) {
                    key.valueTyp = !!key.valueFormat ? valueTypObjectConvention["lakhs"][key.valueFormat] : "100000";
                    key.subHead = key.subHead.replace(/Lakhs|lakhs|Billions|Crores/gi, "Lakhs");
                }
            }
            selector.state.colData = selector.state.colData;
            selector.state.rowData = selector.state.rowData;
            break;
        case "billions":
            for (var _iterator2 = selector.state.colData, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {
                var _ref2;

                if (_isArray2) {
                    if (_i2 >= _iterator2.length) break;
                    _ref2 = _iterator2[_i2++];
                } else {
                    _i2 = _iterator2.next();
                    if (_i2.done) break;
                    _ref2 = _i2.value;
                }

                var _key = _ref2;

                if (_key.valueTyp && _key.valueTyp > 0) {
                    _key.valueTyp = !!_key.valueFormat ? valueTypObjectConvention["billions"][_key.valueFormat] : "1000000000";
                    _key.subHead = _key.subHead.replace(/Lakhs|lakhs|Billions|Crores/gi, "Billions");
                }
            }
            selector.state.colData = selector.state.colData;
            selector.state.rowData = selector.state.rowData;
            break;
        case "crores":
            for (var _iterator3 = selector.state.colData, _isArray3 = Array.isArray(_iterator3), _i3 = 0, _iterator3 = _isArray3 ? _iterator3 : _iterator3[Symbol.iterator]();;) {
                var _ref3;

                if (_isArray3) {
                    if (_i3 >= _iterator3.length) break;
                    _ref3 = _iterator3[_i3++];
                } else {
                    _i3 = _iterator3.next();
                    if (_i3.done) break;
                    _ref3 = _i3.value;
                }

                var _key2 = _ref3;

                if (_key2.valueTyp && _key2.valueTyp > 0) {
                    _key2.valueTyp = !!_key2.valueFormat ? valueTypObjectConvention["crores"][_key2.valueFormat] : "10000000";
                    _key2.subHead = _key2.subHead.replace(/Lakhs|lakhs|Billions|Crores/gi, "Crores");
                }
            }
            selector.state.colData = selector.state.colData;
            selector.state.rowData = selector.state.rowData;
            break;
    }
};

var _MS_PER_DAY = 1000 * 60 * 60 * 24;

// a and b are javascript Date objects
function dateDiffInDays(a, b) {
    try {
        // Discard the time and time-zone information.
        var utc1 = Date.UTC(a.getFullYear(), a.getMonth(), a.getDate());
        var utc2 = Date.UTC(b.getFullYear(), b.getMonth(), b.getDate());

        return Math.floor((utc2 - utc1) / _MS_PER_DAY);
    } catch (e) {
        console.log("dateDiffInDays", e.message);
    }
}

function formatDate(date) {
    try {
        //convert dd-mm-yyyy to date
        var dateVal = date.split("-");
        return new Date(dateVal[2], parseInt(dateVal[1] - 1), dateVal[0]);
    } catch (e) {
        console.log("formatDate", e.message);
    }
}

/* Accessibility Start */
var fontSizeCount = 0;

function increaseFont() {
    if (fontSizeCount < 5) {
        fontSizeCount++;
        fontResize(fontSizeCount);
        setCookie("fontSize", fontSizeCount, 5);
    }
    console.log(fontSizeCount + '||' + $('html').css('fontSize'));
}

function decreaseFont() {
    if (fontSizeCount > -5) {
        fontSizeCount--;
        fontResize(fontSizeCount);
        setCookie("fontSize", fontSizeCount, 5);
    }

    console.log(fontSizeCount + '||' + $('html').css('fontSize'));
}

function resetFont() {
    fontSizeCount = 0;
    fontResize(0);
    setCookie("fontSize", "0", 5);
}

function fontResize(count) {
    try {
        if (count <= 5 && count >= -5) {
            $('html').css('fontSize', 100 + count * 10 + '%');
        }
    } catch (e) {
        console.log("fontResize", e.message);
    }
}
function highContrast() {
    $('body').addClass('body_contrast1');
    contrastGraph();
    setCookie("highContrast", "true", 5);
    $('.download_icon').attr('src', '/assets/images/playstore-white.webp');
}
function normalContrast() {
    $('body').removeClass('body_contrast1');
    resetGraphColor();
    setCookie("highContrast", "false", 5);
    $('.download_icon').attr('src', '/assets/images/playstore.png');
}
function contrastGraph() {
    try {
        $('.stockChart').each(function () {
            $(this).highcharts().series[0].update({
                fillColor: {
                    linearGradient: {
                        x1: 0,
                        y1: 0,
                        x2: 0,
                        y2: 1
                    },
                    stops: [[0, '#333'], [1, 'rgba(0, 0, 0, 0)']]
                }
            });
        });
    } catch (e) {
        console.log("contrastGraph", e.message);
    }
}
function resetGraphColor() {
    try {
        $('.stockChart').each(function () {
            $(this).highcharts().series[0].update({
                fillColor: {
                    linearGradient: {
                        x1: 0,
                        y1: 0,
                        x2: 0,
                        y2: 1
                    },
                    stops: [[0, '#3e85c5'], [1, 'rgba(11, 232, 250, 0)']]
                }
            });
        });
    } catch (e) {
        console.log("resetGraphColor", e.message);
    }
}
/* Accessibility End */

/* Table Sorting */
var sortType = "asc";
var tableHead = "";
var TableSortBy = function TableSortBy(key, id, apiContain) {
    try {
        var _this = eval(apiContain);
        sortType = sortType === "asc" ? "desc" : "asc";
        if (tableHead !== key) {
            sortType = "asc";
        }
        var els = document.querySelectorAll('.toggleIcon');
        for (var i = 0; i < els.length; i++) {
            els[i].classList.remove("asc", "desc");
            els[i].parentNode.setAttribute('aria-sort', 'none');
        }
        if (id !== null) {
            document.getElementById(id).classList.add(sortType);
            document.getElementById(id).parentNode.setAttribute('aria-sort', sortType === 'asc' ? 'ascending' : 'descending');
        }

        var rowSortData = _this.state.rowData.sort(sortTableData(key, sortType));
        tableHead = key;
        _this.state.rowData = rowSortData;
    } catch (e) {
        console.log(e);
    }
};

var sortTableData = function sortTableData(key, order, type) {
    return function (a, b) {
        if (b.priority > 0) {
            return 0;
        }
        if (!a.hasOwnProperty(key) || !b.hasOwnProperty(key)) {
            return 0;
        }

        var varA = void 0,
            varB = void 0;

        if (type && type === "date") {
            var month = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
            var defaultDate = "01-JAN-1900";
            var aVal = a[key] ? a[key] === "-" ? defaultDate.split('-') : a[key].split('-') : [];
            var bVal = b[key] ? b[key] === "-" ? defaultDate.split('-') : b[key].split('-') : [];

            if (aVal[1] && aVal[1].length > 2) {
                aVal[1] = (month.indexOf(aVal[1].toUpperCase()) + 1).toString();
            }
            if (bVal[1] && bVal[1].length > 2) {
                bVal[1] = (month.indexOf(bVal[1].toUpperCase()) + 1).toString();
            }

            varA = new Date(aVal.reverse().join('-'));
            varB = new Date(bVal.reverse().join('-'));
        } else {
            varA = typeof a[key] === 'string' ? type === "number" || type === "quantity" ? parseFloat(a[key]) : a[key].toUpperCase() : a[key];
            varB = typeof b[key] === 'string' ? type === "number" || type === "quantity" ? parseFloat(b[key]) : b[key].toUpperCase() : b[key];
        }

        var comparison = 0;
        if (varA > varB) {
            comparison = 1;
        } else if (varA < varB) {
            comparison = -1;
        }
        return order === 'desc' ? comparison * -1 : comparison;
    };
};
/* Table Sorting End */

function getISTDate() {
    var currentTime = new Date();
    var currentOffset = currentTime.getTimezoneOffset();
    var ISTOffset = 330; // IST offset UTC +5:30
    var ISTTime = new Date(currentTime.getTime() + (ISTOffset + currentOffset) * 60000);
    return ISTTime;
}

/* Date Difference */
function getStartEndDate(days, format) {
    var fulldate = new Date();
    //fulldate.setMonth(fulldate.getMonth() + 1);
    var prefix = 0,
        prefixVal = 0;
    if (typeof format === "undefined") {
        if (fulldate.getMonth() < 9) {
            prefix = "0" + (fulldate.getMonth() + 1);
        } else {
            prefix = fulldate.getMonth() + 1;
        }
    } else if (format === "mmm") {
        prefix = monthNames[fulldate.getMonth()];
    }

    var tday = fulldate.getDate();
    if (tday < 9) {
        tday = "0" + tday;
    }
    var todayDate = [tday, prefix, fulldate.getFullYear()].join('-');
    if (days.indexOf('D') >= 0) {
        var noofday = parseInt(days.replace(/D/gi, ""));
        fulldate.setDate(fulldate.getDate() - noofday);
    } else if (days.indexOf('W') >= 0) {
        var _noofday = parseInt(days.replace(/W/gi, "")) * 7;
        fulldate.setDate(fulldate.getDate() - _noofday);
    } else if (days.indexOf('M') >= 0) {
        var noofmonth = parseInt(days.replace(/M/gi, ""));
        fulldate.setMonth(fulldate.getMonth() - noofmonth);
    } else if (days.indexOf('Y') >= 0) {
        var noofyear = parseInt(days.replace(/Y/gi, ""));
        fulldate.setFullYear(fulldate.getFullYear() - noofyear);
    } else {
        //return "ALL"
        return ["", ""];
    }

    /*switch(days){
        case "1D" :
            fulldate.setDate(fulldate.getDate()  - 1);
            break;
        case "2D" :
            fulldate.setDate(fulldate.getDate()  - 2);
            break;
        case "1W" :
            fulldate.setDate(fulldate.getDate()  - 7);
            break;
        case "1M" :
            fulldate.setMonth(fulldate.getMonth() - 1);
            break;
        case "3M" :
            fulldate.setMonth(fulldate.getMonth() - 3);
            break;
        case "6M" :
            fulldate.setMonth(fulldate.getMonth() - 6);
            break;
        case "1Y" :
            fulldate.setFullYear(fulldate.getFullYear() - 1);
            break;
        case "ALL" :
            return "ALL"
            break;
    }*/

    if (typeof format === "undefined") {
        if (fulldate.getMonth() < 9) {
            prefixVal = "0" + (fulldate.getMonth() + 1);
        } else {
            prefixVal = fulldate.getMonth() + 1;
        }
    } else if (format === "mmm") {
        prefixVal = monthNames[fulldate.getMonth()];
    }

    var fday = fulldate.getDate();
    if (fday < 9) {
        fday = "0" + fday;
    }

    var fromDate = [fday, prefixVal, fulldate.getFullYear()].join('-');
    return [fromDate, todayDate];
}

function getStartEndDateFuture(days, format) {
    var fulldate = new Date();
    //fulldate.setMonth(fulldate.getMonth() + 1);
    var prefix = 0,
        prefixVal = 0;
    if (typeof format === "undefined") {
        if (fulldate.getMonth() < 9) {
            prefix = "0" + (fulldate.getMonth() + 1);
        } else {
            prefix = fulldate.getMonth() + 1;
        }
    } else if (format === "mmm") {
        prefix = monthNames[fulldate.getMonth()];
    }

    var todayDate = [fulldate.getDate(), prefix, fulldate.getFullYear()].join('-');

    if (days.indexOf('D') >= 0) {
        var noofday = parseInt(days.replace(/D/gi, ""));
        fulldate.setDate(fulldate.getDate() + noofday);
    } else if (days.indexOf('W') >= 0) {
        var _noofday2 = parseInt(days.replace(/W/gi, "")) * 7;
        fulldate.setDate(fulldate.getDate() + _noofday2);
    } else if (days.indexOf('M') >= 0) {
        var noofmonth = parseInt(days.replace(/M/gi, ""));
        fulldate.setMonth(fulldate.getMonth() + noofmonth);
    } else if (days.indexOf('Y') >= 0) {
        var noofyear = parseInt(days.replace(/Y/gi, ""));
        fulldate.setFullYear(fulldate.getFullYear() + noofyear);
    } else {
        //return "ALL"
        return ["", ""];
    }

    if (typeof format === "undefined") {
        if (fulldate.getMonth() < 9) {
            prefixVal = "0" + (fulldate.getMonth() + 1);
        } else {
            prefixVal = fulldate.getMonth() + 1;
        }
    } else if (format === "mmm") {
        prefixVal = monthNames[fulldate.getMonth()];
    }
    var fromDate = [fulldate.getDate(), prefixVal, fulldate.getFullYear()].join('-');
    return [todayDate, fromDate];
}
/* Date Difference */
function genComList(data) {
    try {
        $('#QLCorporateCompanies').empty();
        $('#companyCount').text(data.length);
        for (var _iterator4 = data.entries(), _isArray4 = Array.isArray(_iterator4), _i4 = 0, _iterator4 = _isArray4 ? _iterator4 : _iterator4[Symbol.iterator]();;) {
            var _ref4;

            if (_isArray4) {
                if (_i4 >= _iterator4.length) break;
                _ref4 = _iterator4[_i4++];
            } else {
                _i4 = _iterator4.next();
                if (_i4.done) break;
                _ref4 = _i4.value;
            }

            var _ref5 = _ref4,
                _index = _ref5[0],
                element = _ref5[1];

            $('#QLCorporateCompanies').append('<div class="col-md-4 col-sm-6"><div class="card alert alert-dismissible fade show">' + (_index + 1) + '. ' + element + '<a onclick="removeCom(\'' + element + '\')" href="javascript:;" data-dismiss="alert" aria-label="Remove ' + element + '" class="close"></a></div></div>');
        }
    } catch (e) {
        console.log("genComList", e.message);
    }
}
function genComTab() {
    try {
        if (QLCorpCom.length === 0) {
            alert("Select Company");
        } else {
            $('.qlCorpList').remove();
            $('.qlCorpListContain').remove();
            for (var _iterator5 = QLCorpCom.entries(), _isArray5 = Array.isArray(_iterator5), _i5 = 0, _iterator5 = _isArray5 ? _iterator5 : _iterator5[Symbol.iterator]();;) {
                var _ref6;

                if (_isArray5) {
                    if (_i5 >= _iterator5.length) break;
                    _ref6 = _iterator5[_i5++];
                } else {
                    _i5 = _iterator5.next();
                    if (_i5.done) break;
                    _ref6 = _i5.value;
                }

                var _ref7 = _ref6,
                    _index2 = _ref7[0],
                    element = _ref7[1];

                $('#QLCorpTab').append('<li class="nav-item qlCorpList"> <a onclick="genComTable(\'' + element + '\')" class="nav-link" data-bs-toggle="tab" href="#qlink_corporate_02" role="tab" aria-selected="false">' + element + '</a></li>');
            }
            $('#QLCorpTab li.qlCorpList').eq(0).find('a').trigger('click').tab('show');
        }
    } catch (e) {
        console.log("genComTab", e.message);
    }
}

function removeCom(val) {
    try {
        QLCorpCom.splice(QLCorpCom.indexOf(val), 1);
        genComList(QLCorpCom);
    } catch (e) {
        console.log("removeCom", e.message);
    }
}

function genComTable(symbol) {
    try {
        if ($('#QLCorpTable').length) {
            B.get('/api/quick-links-corporate?symbol=' + symbol).then(function (resp) {
                var respJSON = JSON.parse(resp);
                QLCorpTable.state.rowData = respJSON || [];
            });
        } else {
            B.get('/json/quicklinks-Corporate.json').then(function (resp) {
                var respJSONObj = JSON.parse(resp);
                QLCorpTable = customTable({
                    tableStyle: {
                        id: 'QLCorpTable',
                        class: 'common_table customHeight-table tableScroll w-100'
                    }, colData: respJSONObj.columns || [], rowData: []
                });
                B.render(QLCorpTable, B.findOne('#QLCorpWrapper'));
                B.findOne("#QLCorpTable .emptyRow").innerHTML = loader;

                B.get('/api/quick-links-corporate?symbol=' + symbol).then(function (resp) {
                    var respJSON = JSON.parse(resp);
                    QLCorpTable.state.rowData = respJSON || [];
                });
            });
        }
    } catch (e) {
        console.log("genComTable", e.message);
    }
}

function getFileIconPath(fileType) {
    if (!fileType) {
        return;
    }
    var fileIconPath = "/assets/images/download-icon.svg";
    switch (fileType.toLowerCase()) {
        case '.pdf':
            fileIconPath = "/assets/images/icon-pdf.svg";
            break;
        case '.zip':
            fileIconPath = "/assets/images/icon-zip.svg";
            break;
        case '.xls':
            fileIconPath = "/assets/images/icon-xls.svg";
            break;
        case '.xlsx':
            fileIconPath = "/assets/images/icon-xls.svg";
            break;
        case '.doc':
            fileIconPath = "/assets/images/icon-doc.svg";
            break;
        case '.docx':
            fileIconPath = "/assets/images/icon-doc.svg";
            break;
        case '.docs':
            fileIconPath = "/assets/images/icon-docs.svg";
            break;
        case '.xml':
            fileIconPath = "/assets/images/icon-xml.svg";
            break;
        default:
            fileIconPath = "/assets/images/download-icon.svg";
            break;
    }
    return fileIconPath;
}

function initLeftSideMenu() {
    if (!$('#static-left-navigation').length) {
        return;
    }

    var path = window.location.pathname;
    path = path.replace(/\/$/, '');
    path = decodeURIComponent(path);
    path = path.replace("/static", ""); //add by Juned for CMS20 artf1229971
    // first set up active menu
    $('.metismenu a').each(function () {
        var href = ($(this).attr('href') || '').trim();

        // skip invalid values
        if (!href || href[0] === '#') {
            return;
        }
        var modifiyedpathname = this.pathname.replace("/static", ""); //add by Juned for CMS20 artf1229974
        if (modifiyedpathname === path) {
            $(this).attr('aria-expanded', true).parent().addClass('mm-active');
            $(this).attr('aria-current', true).parent().siblings().find('a').attr('aria-current', false);
        }
        if (path === '/nse-clearing') {
            try {
                $("ul.metismenu").first().children("li:nth-child(1)").each(function () {
                    $(this).addClass('mm-active').children('a').attr({ 'aria-expanded': true, 'aria-current': true });
                    $(this).children('ul').addClass('mm-show').children('li:nth-child(1)').addClass('mm-active');
                });
            } catch (error) {
                console.error('An error occurred while applying the active classes:', error);
            }
        }
    });

    // initialize menu
    $('#static-left-navigation').metisMenu();
}

function getEquityType(info) {
    var type = equityKey;
    if (info) {
        var isFNOSec = info.isFNOSec,
            isSLBSec = info.isSLBSec,
            isDebtSec = info.isDebtSec,
            activeSeries = info.activeSeries;

        if (activeSeries && activeSeries.length > 0 && !activeSeries.includes('GS')) {
            type = equityKey;
        } else if (isFNOSec && !isSLBSec && !isDebtSec) {
            type = derivativeKey;
        } else if (!isFNOSec && isSLBSec && !isDebtSec) {
            type = slbKey;
        } else if (!isFNOSec && !isSLBSec && isDebtSec || activeSeries && activeSeries.includes('GS')) {
            type = bondsKey;
        };
    }
    return type;
}

initLeftSideMenu();

var refreshApiEvent = true;

function refreshApi(api, selectId) {
    if (refreshApiEvent) {
        refreshApiEvent = false;

        var selectedVal = void 0;
        if (activeTabVal !== undefined) {
            selectedVal = activeTabVal;
        } else {
            selectedVal = $(selectId).find('option:selected').val();
        }

        if (typeof window[api] === 'function') {
            window[api](selectedVal);
        } else {
            console.error('Function ' + api + ' does not exist.');
        }

        setTimeout(function () {
            refreshApiEvent = true;
        }, 2000);

        var nsetranslateEvent = new CustomEvent('element_render_end_custom_event');
        document.dispatchEvent(nsetranslateEvent);
    }
}

function dynamicSort(property) {
    var sortOrder = 1;

    if (property[0] === "-") {
        sortOrder = -1;
        property = property.substr(1);
    }

    return function (a, b) {
        if (sortOrder == -1) {
            return b[property].localeCompare(a[property]);
        } else {
            return a[property].localeCompare(b[property]);
        }
    };
}
function refreshPage() {
    window.location.reload();
}
function updateMarketStatus() {
    try {
        autoUpdateMarket = setTimeout(function () {
            B.get('/api/marketStatus').then(function (resp) {
                var respJSON = JSON.parse(resp);
                var updateMarketCount = 0;
                for (var _iterator6 = respJSON.marketState.entries(), _isArray6 = Array.isArray(_iterator6), _i6 = 0, _iterator6 = _isArray6 ? _iterator6 : _iterator6[Symbol.iterator]();;) {
                    var _ref8;

                    if (_isArray6) {
                        if (_i6 >= _iterator6.length) break;
                        _ref8 = _iterator6[_i6++];
                    } else {
                        _i6 = _iterator6.next();
                        if (_i6.done) break;
                        _ref8 = _i6.value;
                    }

                    var _ref9 = _ref8,
                        _index3 = _ref9[0],
                        key = _ref9[1];

                    // remove closed to open after testing
                    if (key.last && key.last !== "" && !!key.marketStatus && key.marketStatus.toLowerCase() === "open") {

                        if (key.market.toLowerCase() === 'currencyfuture') {
                            // fix: update currencyfuture last price value
                            $('.home-header-currencyfuturelast').html(DecimalFixed(key.last, false, false, 4));
                            $('.currencyfuture-tradedate').text(key.tradeDateFormatted);
                        } else if (key.market.toLowerCase() === 'capital market' && !niftyHeaderSocket) {
                            $(".header-nifty-val").text('' + key.last.toLocaleString("en-IN", { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
                            $(".header-up-down").attr('class', 'header-up-down market-up-down fa ' + (key.percentChange >= 0 ? "fa-caret-up cool-green" : "fa-caret-down cool-red"));
                            $(".header-txt-color").attr('class', 'header-txt-color per ' + (key.percentChange >= 0 ? "greenTxt" : "redTxt"));
                            $(".header-change").text('' + key.variation.toLocaleString("en-IN", { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
                            $(".header-perChange").text('' + key.percentChange);
                            $(".header-tradeDate").text('' + key.tradeDate);
                        }
                    } else {
                        updateMarketCount++;
                    }
                }
                // Indicative close start here 
                if (respJSON && respJSON.indicativenifty50 && respJSON.indicativenifty50.status.toLowerCase() === 'open' && !niftyHeaderSocket) {
                    $('.marketStat-nifty50_Indicative .ltp').text(DecimalFixed(respJSON.indicativenifty50.closingValue));
                    $('.marketStat-nifty50_Indicative .per').text(DecimalFixed(respJSON.indicativenifty50.change) + ' (' + respJSON.indicativenifty50.perChange + '%)');
                    $('.nifty50-indicative-tradedate').html(respJSON.indicativenifty50.dateTime);
                    $('.marketStat-nifty50_Indicative .market-up-down').remove();
                    if (respJSON.indicativenifty50.perChange >= 0) {
                        $('.marketStat-nifty50_Indicative .index_val').append(' <i class="market-up-down fa fa-caret-up cool-green"></i>');
                        $('.marketStat-nifty50_Indicative .per').removeClass('redTxt').addClass('greenTxt');
                    } else {
                        $('.marketStat-nifty50_Indicative .index_val').append(' <i class="market-up-down fa fa-caret-down cool-red"></i>');
                        $('.marketStat-nifty50_Indicative .per').removeClass('greenTxt').addClass('redTxt');
                    }
                } else {
                    updateMarketCount++;
                }
                // Gift Nifty start here 
                if (respJSON && respJSON.giftnifty && respJSON.giftnifty.length !== 0) {
                    $('.marketStat-giftnifty .per').text(DecimalFixed(respJSON.giftnifty.DAYCHANGE) + ' (' + respJSON.giftnifty.PERCHANGE.trim() + '%)');
                    $('.marketStat-giftnifty .lastprice').text(DecimalFixed(respJSON.giftnifty.LASTPRICE));
                    $('.marketStat-giftnifty .expirydate').text('Futures  ' + respJSON.giftnifty.EXPIRYDATE);
                    $('.giftnifty-tradedate').html(respJSON.giftnifty.TIMESTMP);
                    if (respJSON.giftnifty.PERCHANGE.trim() >= 0) {
                        $('.marketStat-giftnifty .index_val').append(' <i class="market-up-down fa fa-caret-up cool-green"></i>');
                        $('.marketStat-giftnifty .per').removeClass('redTxt').addClass('greenTxt');
                    } else {
                        $('.marketStat-giftnifty .index_val').append(' <i class="market-up-down fa fa-caret-down cool-red"></i>');
                        $('.marketStat-giftnifty .per').removeClass('greenTxt').addClass('redTxt');
                    }
                } else {
                    updateMarketCount++;
                }
                //stop Market Update
                respJSON.marketState.length === updateMarketCount ? clearTimeout(autoUpdateMarket) : updateMarketStatus();
                // comment below code after testing
                // updateMarketStatus();
            });
        }, 60000);
    } catch (e) {
        console.error('(common.js)Error in updateMarketStatus', e);
    }
}
function generateCSRF() {
    try {
        setTimeout(function () {
            B.get('/api/commonnse').then(function (resp) {});
        }, 100);
    } catch (e) {
        console.log(e);
    }
}

// reloadPageGenerateToken();
// function reloadPageGenerateToken(){
//     try {
//        setTimeout(function(){
//          window.location.reload();
//        },1500000);
//     } catch (error) {
//         console.log(error)
//     }
// }

function generateUID() {
    var length = 8;
    var timestamp = new Date().getTime();
    var id = (timestamp + Math.random()).toString(36).substr(2, length);
    return id;
}

function convertToReadMore(content) {
    var limit = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 120;

    var uniqueId = generateUID();
    content = content.replace(/\s\s+/g, ' ');
    var firstHalf = content.substr(0, limit);
    var secondHalf = content.substr(limit, content.length);
    var dotId = uniqueId + '-dots';
    var moreId = uniqueId + '-more';
    var btnId = uniqueId + '-rmBtn';
    if (content.length <= limit) {
        return p({ class: "readMoreP" }, content);
    } else {
        return p({ class: "readMoreP" }, firstHalf, span({ id: dotId }, "..."), span({ id: moreId, style: "display: none" }, secondHalf), a({ href: "javascript:;", class: "readMore", role: "link", id: btnId, onclick: 'readMore("' + dotId + '", "' + moreId + '", "' + btnId + '")', 'aria-label': "Read more" }, "Read more"));
    }
}

function readMore(dotId, moreId, btnId) {
    var dots = document.getElementById(dotId);
    var moreText = document.getElementById(moreId);
    var btnText = document.getElementById(btnId);

    if (dots.style.display === "none") {
        dots.style.display = "inline";
        btnText.innerHTML = "Read more";
        moreText.style.display = "none";
        $(btnText).attr('aria-label', 'Read more');
    } else {
        dots.style.display = "none";
        btnText.innerHTML = " Read less";
        moreText.style.display = "inline";
        $(btnText).attr('aria-label', 'Read less');
    }
}

function derivativeStatusSlick() {
    $derivSlider = $("#nseDerivStatus .innerContainer");
    $derivSlider.slick({
        dots: false,
        vertical: true,
        infinite: true,
        autoplay: true,
        arrows: false,
        autoplaySpeed: 5000
    });
    $derivSlider.on('wheel', function (e) {
        e.preventDefault();
        return 0;
    });
}

function addClickListenerToDaysListing(dayslistingFieldId, startDateField, toDateField) {
    $(dayslistingFieldId).click(function () {
        var DateRange = getStartEndDate($(this).data('val'));
        if (DateRange !== 'ALL') {
            $(startDateField).val(DateRange[0]);
            $(toDateField).val(DateRange[1]);
        } else {
            $(startDateField).val('');
            $(toDateField).val('');
        }

        $(dayslistingFieldId + '.active').removeClass('active');
        $(this).addClass('active');
    });
}

// use callback to throw error.
/*function downloadFile(url, errCallback) {
    try {
        if(checkDownloadFile) {
            checkDownloadFile = false;

            downloadAnchorTag = $('.histo-data-block').find('.xlsdownload a').html();
            $('.histo-data-block').find('.xlsdownload a').html(downloadAnchorTag.replace(/Download/g, "Downloading..."));

            const a = document.createElement("a");
            a.style.display = "none";
            document.body.appendChild(a);

            // Set the HREF to a Blob representation of the data to be downloaded
            a.href = `${window.location.origin}${url}`

            // Use download attribute to set set desired file name
            a.setAttribute("download", '');

            // Trigger the download by simulating click

            if (a.click()) {
                $.get(url, function (response) {
                    checkDownloadFile = true;
                    $('.histo-data-block').find('.xlsdownload a').html(downloadAnchorTag);
                    if (response.error) {
                        if (errCallback) {
                            errCallback(response);
                        }
                        showErrorSnackBar("Error in downloading file")
                    } else {
                        showErrorSnackBar("Your file will be downloaded in a moment", 1)
                        // Create an invisible A element

                        // Cleanup
                        window.URL.revokeObjectURL(a.href);
                        document.body.removeChild(a);
                    }
                })
                    .fail(function (error) {
                        if (error.responseJSON) {
                            errCallback(error.responseJSON)
                        } else {
                            errCallback(error)
                        }
                    });
            } else {
                checkDownloadFile = true;
                $('.histo-data-block').find('.xlsdownload a').html(downloadAnchorTag);
            }
        }

    } catch (error) {
        checkDownloadFile = true;
        $('.histo-data-block').find('.xlsdownload a').html(downloadAnchorTag);

        showErrorSnackBar("Error in downloading file");
        console.log(error, "error");
    }
}*/

function downloadFile(url, errCallback) {
    $.get(url, function (response) {
        if (response.error) {
            if (errCallback) {
                errCallback(response);
            }
            showErrorSnackBar("Error in downloading file");
        } else {
            showErrorSnackBar("Your file will be downloaded in a moment", 1);
            // Create an invisible A element
            var _a = document.createElement("a");
            _a.style.display = "none";
            document.body.appendChild(_a);

            // Set the HREF to a Blob representation of the data to be downloaded
            _a.href = '' + window.location.origin + url;

            // Use download attribute to set set desired file name
            _a.setAttribute("download", '');

            // Trigger the download by simulating click
            _a.click();

            // Cleanup
            window.URL.revokeObjectURL(_a.href);
            document.body.removeChild(_a);
        }
    }).fail(function (error) {
        if (error.responseJSON) {
            errCallback(error.responseJSON);
        } else {
            errCallback(error);
        }
    });
}

//download historical button changes
function downloadHistoricalFile(url, errCallback) {
    try {
        if (checkDownloadFile) {
            checkDownloadFile = false;

            downloadAnchorTag = $('.histo-data-block').find('.xlsdownload a').html();
            $('.histo-data-block').find('.xlsdownload a').html(downloadAnchorTag.replace(/Download/g, "Downloading..."));
            // $('#pageLoader').show();
            // showErrorSnackBar("Your file will be downloaded in a moment", 1)
            var _a2 = document.createElement("a");
            _a2.style.display = "none";
            document.body.appendChild(_a2);

            // Set the HREF to a Blob representation of the data to be downloaded
            _a2.href = '' + window.location.origin + url;

            // Use download attribute to set set desired file name
            _a2.setAttribute("download", '');

            // Trigger the download by simulating click

            setTimeout(function () {
                if (_a2.click()) {
                    $.get(url, function (response) {
                        checkDownloadFile = true;
                        if (response.error) {
                            if (errCallback) {
                                errCallback(response);
                            }
                            showErrorSnackBar("Error in downloading file");
                        } else {
                            showErrorSnackBar("Your file will be downloaded in a moment", 1);
                            // Create an invisible A element
                            // $('#pageLoader').hide();
                            // Cleanup
                            window.URL.revokeObjectURL(_a2.href);
                            document.body.removeChild(_a2);
                            $('.histo-data-block').find('.xlsdownload a').html(downloadAnchorTag);
                        }
                    }).fail(function (error) {
                        if (error.responseJSON) {
                            errCallback(error.responseJSON);
                        } else {
                            errCallback(error);
                        }
                    });
                    // $('#pageLoader').hide();
                } else {
                    checkDownloadFile = true;
                    $('.histo-data-block').find('.xlsdownload a').html(downloadAnchorTag);
                }
            }, 500);
        }
    } catch (error) {
        checkDownloadFile = true;
        $('.histo-data-block').find('.xlsdownload a').html(downloadAnchorTag);
        showErrorSnackBar("Error in downloading file");
        console.log(error, "error");
    }
}

function getTypeBySeries(series) {
    if (series) {
        if (series.toUpperCase() == 'EQ') return equityKey;
        if (['SM', 'ST'].includes(series.toUpperCase())) return sme;
        if (series.toUpperCase() == 'EQ') return equityKey;
    }
    return equityKey;
}

function currencySymbol(name) {
    try {
        var symbolName = name.toLowerCase();
        if (typeof symbolName === "undefined" || symbolName === null) {
            return "";
        }
        switch (symbolName) {
            case "usd":
                return "$";
                break;
            case "gbp":
                return "₤";
                break;
            case "euro":
                return "€";
                break;
            case "yen":
                return "¥";
                break;
        }
    } catch (e) {
        console.log(e);
        return "";
    }
}

var renderCaptcha = function renderCaptcha() {
    B.get('/api/recaptcha-client-secret').then(function (resp) {
        var captcha = JSON.parse(resp);
        grecaptcha.render('recaptcha', {
            'sitekey': captcha.key
        });
    });
};

function showErrorSnackBar(errorMsg, type) {
    var timeout = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 3000;

    var x = document.getElementById("error-snackbar");
    x.className = x.classList.remove("show"); // hide if being shown.
    if (errSnackbarTimeout) {
        clearTimeout(errSnackbarTimeout);
    }
    x.innerHTML = "<i class=\"fa fa-times-circle\"></i> " + errorMsg;
    switch (type) {
        case 1:
            x.classList.add("notError");
            x.innerHTML = "<i class=\"fa fa-check-circle\"></i> ";
            break;
        case 2:
            x.classList.add("warning");
            x.innerHTML = "<i class=\"fa fa-exclamation-triangle\"></i> ";
            break;
        default:
            x.innerHTML = "<i class=\"fa fa-times-circle\"></i> ";
    }
    x.innerHTML += errorMsg;
    x.classList.add("show");
    errSnackbarTimeout = setTimeout(function () {
        x.className = x.classList.remove("show");
        switch (type) {
            case 1:
                x.classList.remove("notError");
                break;
            case 2:
                x.classList.remove("warning");
                break;
        }
    }, timeout);
}

function collapseAll(id) {
    try {
        var _this = $('#' + id);
        _this.find('.card-link').addClass('collapsed');
        _this.find('.collapse').removeClass('show');
    } catch (e) {
        console.log(e);
    }
}

function expandAll(id) {
    try {
        var _this = $('#' + id);
        _this.find('.card-link').removeClass('collapsed');
        _this.find('.collapse').addClass('show');
    } catch (e) {
        console.log(e);
    }
}

function removeURLParameter(url, parameter) {
    //prefer to use l.search if you have a location/link object
    var urlparts = url.split('?');
    if (urlparts.length >= 2) {

        var prefix = encodeURIComponent(parameter) + '=';
        var pars = urlparts[1].split(/[&;]/g);

        //reverse iteration as may be destructive
        for (var i = pars.length; i-- > 0;) {
            //idiom for string.startsWith
            if (pars[i].lastIndexOf(prefix, 0) !== -1) {
                pars.splice(i, 1);
            }
        }

        return urlparts[0] + (pars.length > 0 ? '?' + pars.join('&') : '');
    }
    return url;
}

// Form validation helper functions
var errMsg = function errMsg(eleId) {
    var errElement = document.getElementById(eleId);
    return {
        show: function show(msg) {
            errElement.innerHTML = msg;
            errElement.hidden = false;
        },
        hide: function hide() {
            errElement.hidden = true;
        }
    };
};

var resetAllFields = function resetAllFields(form) {
    form.forEach(function (field) {
        document.getElementById(field.id).value = '';
        document.getElementById(field.errId).innerHTML = '';
        document.getElementById(field.errId).hidden = true;
        grecaptcha.reset();
    });
};

var formMsg = function formMsg(formId, msg, isError) {
    var field = document.getElementById(formId);
    field.innerHTML = msg;
    if (isError) {
        field.classList.remove('greenTxt');
        field.classList.add('redTxt');
    } else {
        field.classList.remove('redTxt');
        field.classList.add('greenTxt');
    }
    field.hidden = false;
};

var validate = function validate(field) {
    var _ref10;

    var value = "";
    var errField;
    if ($("#" + field.id).attr("type") === "radio") {
        value = $("#" + field.id + ":checked").val() != undefined ? $("#" + field.id + ":checked").val() : "";
    } else {
        value = document.getElementById(field.id).value;
    }
    if (field.errId) {
        errField = errMsg(field.errId);
    }
    if (field.required) {
        if (value == "") {
            errField.show(field.requiredErrMsg);
            throw field.requiredErrMsg;
        }
    }

    if (field.validations) {
        field.validations(value).forEach(function (inValid) {
            if (inValid) {
                errField.show(field.invalidErrMsg);
                throw field.invalidErrMsg;
            }
        });
    }
    if (typeof errField !== "undefined" && errField != "null") {
        errField.hide();
    }
    return _ref10 = {}, _ref10[field.name] = value, _ref10;
};

function checkValidDate(frmDate, toDate) {
    try {
        var date1 = frmDate.split('-');
        var date2 = toDate.split('-');
        var d1 = new Date(date1[2], parseInt(date1[1]) - 1, date1[0]);
        var d2 = new Date(date2[2], parseInt(date2[1]) - 1, date2[0]);
        return d1 <= d2;
    } catch (e) {
        return false;
        console.log(e);
    }
}

function checkRightDate(frmDate, toDate) {
    try {
        var date1 = frmDate.split('-');
        var date2 = toDate.split('-');
        var d1 = new Date(date1[2], parseInt(date1[1]) - 1, date1[0]);
        var d2 = new Date(date2[2], parseInt(date2[1]) - 1, date2[0]);
        if (d1.getDate() && d2.getDate()) {
            return true;
        } else {
            return false;
        }
    } catch (e) {
        return false;
        console.log(e);
    }
}

function selectFirst(selector) {
    B.findOne(selector).selectedIndex = 0;
}
function setTextEmpty(selector) {
    B.findOne(selector).value = "";
}

function intervalKeeper(totalTime, interval, callThis) {
    //console.log("intervalKeeper");
    var count = 0,
        maxCount = totalTime / interval || 2;
    var holder = setInterval(function () {
        //console.log("count,maxCount,holder",count,maxCount,holder);
        if (count < maxCount) {
            try {
                var result = callThis();
                if (result) {
                    clearInterval(holder);
                }
            } catch (e) {
                console.log("Interval function throws error ", e);
                clearInterval(holder);
            } finally {
                count++;
            }
        } else {
            clearInterval(holder);
        }
    });
}
function updateAsPerCookies() {
    var highContrasEnabled = getCookie("highContrast");
    var fontSize = getCookie("fontSize");
    if (highContrasEnabled === "true") {
        highContrast();
    }
    if (fontSize) {
        fontResize(fontSize);
    }
}
updateAsPerCookies();

// Circular forms Js
var cr_resetAllFields = function cr_resetAllFields(form) {
    try {
        form.forEach(function (field) {

            if (field.name !== '_csrf') {
                if (field.id && field.id !== null) document.getElementById(field.id).value = '';

                if (field.errId !== undefined && field.errId !== null) {
                    document.getElementById(field.errId).innerHTML = '';
                    document.getElementById(field.errId).hidden = true;
                }
                grecaptcha.reset();
            }
        });
    } catch (error) {}
};

$('#selectAll, label[aria-labelledby="select all"]').on('click keypress', function () {
    var _this = $(this);
    if (_this.find('input').is(":checked")) {
        _this.attr('aria-checked', true);
    } else {
        _this.attr('aria-checked', false);
    }
});

$('#goBackSite').on('click keydown mousedown', function (e) {
    $('.fullViewBtn').focus();
});

$('.fullViewBtn').on('click keydown mousedown', function (e) {
    setTimeout(function () {
        $('#goBackSite').focus();
    }, 500);
});

$('.plusbtn').on('click', function (e) {
    var _this = $(this);
    setTimeout(function () {
        _this.parent().find(".custom_select select").last().focus();
    }, 500);
});

if ($('.collapse .nav-tabs').length && $('.collapse .nav-tabs--vertical').attr('role') === "navigation") {
    $('.collapse .nav-tabs--vertical li.nav-item').each(function () {
        $(this).find('a.nav-link').click(function () {
            $(this).attr('aria-selected', true).parent().siblings().find('a').attr('aria-selected', false);
        });
    });
}

// if($('#filing_dash .nav-tabs').length && $('#filing_dash .nav-tabs').attr('role') === "tablist"){
//     $('#filing_dash .nav-tabs').each(function(){
//         $(this).find('a.nav-link').click(function(){
//             $(this).attr('aria-selected', true).parent().siblings().find('a').attr('aria-selected', false)
//         })
//     });
// }

if ($('ul.nav-tabs').length && $('ul.nav-tabs li.nav-item').length && $('ul.nav-tabs').attr('role') === "tablist") {
    $('ul.nav-tabs').each(function () {
        if ($(this).find('li.nav-item a').attr('aria-selected')) {
            $(this).find('li.nav-item').click(function () {
                $(this).children('a').attr('aria-selected', true).parent().siblings().find('a').attr('aria-selected', false);
            });
        }
    });
}

$('ul.nav-tabs').each(function () {
    if ($(this).find('li.nav-item').length && $(this).attr('role') === "tablist" && $(this).find('li.nav-item').attr('role') === "tab") {
        if ($(this).find('li.nav-item').attr('aria-selected')) {
            $(this).find('li.nav-item').click(function () {
                $(this).attr('aria-selected', true).siblings().attr('aria-selected', false);
            });
        }
    }
});

$('#capital_to_equities_historical a').on('click keydown mousedown', function (e) {
    setTimeout(function () {
        $('#capital_to_equities_card a').focus();
    }, 500);
});
$('#capital_to_equities_card a').on('click keydown mousedown', function (e) {
    setTimeout(function () {
        $('#capital_to_equities_historical a').focus();
    }, 500);
});

$('.indices_list_btn a.btn').on('click keydown mousedown', function (e) {
    setTimeout(function () {
        $('#selectIndicesModal .close').eq(0).focus();
    }, 500);
});

$('.dayslisting li.customFilter a').attr('aria-expanded', 'false');
$('.dayslisting li.customFilter').on('click', function () {
    var _this = $(this);
    $(this).children('a').attr('aria-expanded', $(this).children('a').attr('aria-expanded') == 'false' ? 'true' : 'false');
    if ($(this).children('a').attr('aria-expanded') == 'true') {
        setTimeout(function () {
            // $(_this).closest('.tab-content').find('.block-detail-dates-box .startDate-block-deals').focus();
            // $(_this).closest('.vtab_container').find('.date-format-relate input').eq(0).focus();
            $(_this).closest(".tab-pane").find(".hide .block-detail-dates-box .startDate-block-deals").focus();
        }, 500);
    }
});

$('.dayslisting li').on('click', function () {
    if ($(this).find('a').hasClass('active')) {
        $(this).find('a').attr('aria-current', true).parent().siblings('li').not(".customFilter, .clearFilter").find('a').attr('aria-current', false);
    }
});

$('.dayslisting li.clearFilter a').on('click', function () {
    $(this).closest('.tab-pane').find('.dayslisting li.customFilter a').attr('aria-expanded', 'false');
});

$('.dayslisting li.customFilter a').on('click', function () {
    $("#historicalDateFilter").slideToggle();
});

$('.dayslisting li.clear a').on('click', function () {
    $("#historicalDateFilter").slideUp();
});

$('#offers_tender li, #mutual-fund li, #others-noncompetitive li, #offers_ipp li, #offers_invits li, #offers_ofs li, #offers_rights li, #offers_reits li').on('click', function () {
    $(this).attr('aria-selected', true).siblings().attr('aria-selected', false);
});

$(document).on('click', '.card-body .fav', function () {
    $(this).attr('aria-pressed', $(this).attr('aria-pressed') == 'true' ? 'false' : 'true');
});

if ($('#arrowInfoStatus .invisibleText').length && $('#arrowInfoStatus').hasClass('blkbox-greentxt')) {
    $('#arrowInfoStatus').find('.invisibleText').text('quote value High');
    $('#arrowInfoStatus').attr('aria-label', 'quote value High');
} else {
    $('#arrowInfoStatus').find('.invisibleText').text('quote value Low');
    $('#arrowInfoStatus').attr('aria-label', 'quote value Low');
}

// $('.mkt_updown').each(function(){
//     var _this = $(this)
//     setTimeout(function(){
//         if(_this.find('.invisibleText') && _this.find('.arrow').hasClass('arrow-up-green')){
//             _this.find('.invisibleText').text('High');
//         }else{
//             _this.find('.invisibleText').text('Low');
//         }
//     },1500)
// })


$('#main_navbar ul li').on('mouseenter', function (e) {
    $(this).removeClass('show');
    $(this).find('.dropdown-menu').removeClass('show');
});
$('#main_navbar ul li').on('mouseleave', function (e) {
    $(this).removeClass('show');
    $(this).find('.dropdown-menu').removeClass('show');
});

$('#main_navbar > ul > li.dropdown').on('mouseleave', function (e) {
    $(this).children('a.nav-link').attr('aria-expanded', false);
});

$(document).on('mouseenter', '.show_link', function () {
    $(this).find('.hover_table').attr('aria-hidden', 'false');
});
$(document).on('mouseleave', '.show_link', function () {
    $(this).find('.hover_table').attr('aria-hidden', 'true');
});

$('.staticAccord a').on('click keydown mousedown', function (e) {
    $(this).attr('aria-current', true).siblings().attr('aria-current', false);
});

// $('.navbar-toggler').on('click', function(){
//     if($('#main_navbar').hasClass('show')) {
//       //  $('body').removeClass('bodyOverflow');
//     }else{
//         $('body').addClass('bodyOverflow');
//     }

// });
$('#main_navbar').on('shown.bs.collapse', function () {
    $('.menu_mobile_toggle').css("padding-bottom", "20px");
});
$('#main_navbar').on('hidden.bs.collapse', function () {
    $('.menu_mobile_toggle').css("padding-bottom", "0");
});

$('#selectIndicesModal .modal-body ul li').each(function (e) {
    var inputCheck = $(this).find('input');
    inputCheck.click(function () {
        if ($(this).is(':checked')) {
            $(this).parent('label').attr('aria-checked', true);
        } else {
            $(this).parent('label').attr('aria-checked', false);
        }
    });
});

setTimeout(function () {
    $('label.chk_container').each(function () {
        $(this).attr('tabindex', 0);
        $(this).on('keypress', function (e) {
            if (e.keyCode == 32) {
                e.target.getElementsByTagName('input')[0].click();
                e.preventDefault();
            }
        });
    });
});

if ($('table').length) {
    $('table').prepend('<caption></caption>');
}

window.addEventListener('keydown', handleKey);
// uncomment and place this in the dialog close/hide function to remove the listener when dialog is closed/hidden
// window.removeEventListener('keydown', handleKey);

function handleKey(e) {
    if (e.keyCode === 9) {
        var focusable = document.querySelector('.tab-content .tab-pane.active.show').querySelectorAll('input,button,select,a,textarea');
        if (focusable.length) {
            var first = focusable[0];
            var last = focusable[focusable.length - 1];
            var shift = e.shiftKey;
            if (shift) {
                if (e.target === first) {
                    // shift-tab pressed on first input in dialog
                    last.focus();
                    e.preventDefault();
                }
            } else {
                if (e.target === last) {
                    // tab pressed on last input in dialog
                    first.focus();
                    e.preventDefault();
                }
            }
        }
    }
}

window.addEventListener('keydown', handleKey1);
function handleKey1(e) {
    if (e.keyCode === 9) {
        var disclaimerQuerySelector = document.querySelector('#disclaimerPopup');
        if (disclaimerQuerySelector && disclaimerQuerySelector !== null) {
            var focusable = disclaimerQuerySelector.querySelectorAll('input,button,select,a,textarea');
            if (focusable.length) {
                var first = focusable[0];
                var last = focusable[focusable.length - 1];
                var shift = e.shiftKey;
                if (shift) {
                    if (e.target === first) {
                        // shift-tab pressed on first input in dialog
                        last.focus();
                        e.preventDefault();
                    }
                } else {
                    if (e.target === last) {
                        // tab pressed on last input in dialog
                        first.focus();
                        e.preventDefault();
                    }
                }
            }
        }
    }
}

window.addEventListener('keydown', handleKey2);
function handleKey2(e) {
    if (e.keyCode === 9) {
        var focusable = document.querySelector('#qlink_investors').querySelectorAll('input,button,select,a,textarea');
        if (focusable.length) {
            var first = focusable[0];
            var last = focusable[focusable.length - 1];
            var shift = e.shiftKey;
            if (shift) {
                if (e.target === first) {
                    // shift-tab pressed on first input in dialog
                    last.focus();
                    e.preventDefault();
                }
            } else {
                if (e.target === last) {
                    // tab pressed on last input in dialog
                    first.focus();
                    e.preventDefault();
                }
            }
        }
    }
}

window.addEventListener('keydown', handleKey3);
function handleKey3(e) {
    if (e.keyCode === 9) {
        var focusable = document.querySelector('#qlink_members').querySelectorAll('input,button,select,a,textarea');
        if (focusable.length) {
            var first = focusable[0];
            var last = focusable[focusable.length - 1];
            var shift = e.shiftKey;
            if (shift) {
                if (e.target === first) {
                    // shift-tab pressed on first input in dialog
                    last.focus();
                    e.preventDefault();
                }
            } else {
                if (e.target === last) {
                    // tab pressed on last input in dialog
                    first.focus();
                    e.preventDefault();
                }
            }
        }
    }
}

window.addEventListener('keydown', handleKey4);
function handleKey4(e) {
    if (e.keyCode === 9) {
        var focusable = document.querySelector('#qlink_corporates').querySelectorAll('input,button,select,a,textarea');
        if (focusable.length) {
            var first = focusable[0];
            var last = focusable[focusable.length - 1];
            var shift = e.shiftKey;
            if (shift) {
                if (e.target === first) {
                    // shift-tab pressed on first input in dialog
                    last.focus();
                    e.preventDefault();
                }
            } else {
                if (e.target === last) {
                    // tab pressed on last input in dialog
                    first.focus();
                    e.preventDefault();
                }
            }
        }
    }
}

if ($('#selectIndicesModal').length) {
    window.addEventListener('keydown', handleKey5);
}
function handleKey5(e) {
    if (e.keyCode === 9) {
        var focusable = document.querySelector('#selectIndicesModal').querySelectorAll('input,button,select,a,textarea');
        if (focusable.length) {
            var first = focusable[0];
            var last = focusable[focusable.length - 1];
            var shift = e.shiftKey;
            if (shift) {
                if (e.target === first) {
                    // shift-tab pressed on first input in dialog
                    last.focus();
                    e.preventDefault();
                }
            } else {
                if (e.target === last) {
                    // tab pressed on last input in dialog
                    first.focus();
                    e.preventDefault();
                }
            }
        }
    }
}
function changeStockPriceFieldsToHindi(stock) {
    var stockPriceFields = ['totalTradedValue', 'lastPrice', 'pChange', 'totalTradedVolume'];
    for (var i = 0; i < stockPriceFields.length; i++) {
        var field = stockPriceFields[i];
        stock[field] = stock[field] ? stock[field].toLocaleString("hi-u-nu-deva") : stock[field];
    }
}

function changeStockPriceFieldsToNonEng(stock) {
    var stockPriceFields = ['totalTradedValue', 'lastPrice', 'pChange', 'totalTradedVolume'];
    for (var i = 0; i < stockPriceFields.length; i++) {
        var field = stockPriceFields[i];
        stock[field] = stock[field] ? stock[field].toLocaleString(localeMap[selectedLang]) : stock[field];
    }
}

function changeStockSymboFieldsToHindi(stock, _ref11) {
    var hi = _ref11.hi,
        en = _ref11.en;

    stock['symbol'] = hi[stock['symbol']];
}
function changeStockSymboFieldsToNonEng(stock, _ref12) {
    var hi = _ref12.hi,
        en = _ref12.en,
        gu = _ref12.gu,
        mr = _ref12.mr;

    switch (selectedLang) {
        case hiLocaleAcronnym:
            stock['symbol'] = hi[stock['symbol']];
            break;
        case guLocaleAcronnym:
            stock['symbol'] = gu[stock['symbol']];
            break;
        case mrLocaleAcronnym:
            stock['symbol'] = mr[stock['symbol']];
            break;
    }
}

function translateStocksTo(stocks) {
    try {
        var stockPriceFields = ['totalTradedValue', 'lastPrice', 'pChange', 'totalTradedVolume'];
        stocks = stocks.map(function (stock) {
            for (var i = 0; i < stockPriceFields.length; i++) {
                var value = stock[stockPriceFields[i]];
                stock[stockPriceFields[i]] = value ? +value.toFixed(2) : value;
            }
            return stock;
        });

        // read selected lang, if hindi only then translate price fields and symbols 
        if (selectedLang !== 'en' || !!selectedLang) {
            try {
                var _JSON$parse = JSON.parse(localStorage.getItem('symbolsLang')),
                    hi = _JSON$parse.hi,
                    en = _JSON$parse.en,
                    gu = _JSON$parse.gu,
                    mr = _JSON$parse.mr;

                stocks = stocks.map(function (stock) {
                    // changeStockPriceFieldsToNonEng(stock);
                    changeStockSymboFieldsToNonEng(stock, { hi: hi, en: en, gu: gu, mr: mr });
                    return stock;
                });
            } catch (error) {}
        }
    } catch (err) {}
    return stocks;
}
function storeSymbolsInStorageAllLang(symbolsInLang, selectedLang) {
    var symbolsLang = {};
    symbolsLang[selectedLang] = symbolsInLang;
    localStorage.setItem("symbolsLang", JSON.stringify(symbolsLang));
}

$('#listlanguages').change(function () {
    selectedLang = $(this).val();
    setCookie("lang", selectedLang);
    location.reload();
});
$('#newbtn').click(function () {
    setCookie("lang", 'hi');
    window.open('http://NSE-UAT-WEB-PUB-LB-287078292.ap-south-1.elb.amazonaws.com/hindi', '_blank');
});
if (!!selectedLang) {
    $('#listlanguages option[value=' + selectedLang + ']').prop('selected', true);
} else {
    $('#listlanguages option[value=' + defaultLang + ']').prop('selected', true);
}

// multilang();
var myTimeout = setTimeout(multilang, 6000);

multilang();
// conditional loading to solve sometimes mix language translation issue
if (selectedLang == 'hi') {
    B.get('/json/hindisymbols.json').then(function (resp) {
        storeSymbolsInStorageAllLang(JSON.parse(resp), "hi");
    });
} else if (selectedLang == 'mr') {
    B.get('/json/marathisymbols.json').then(function (resp) {
        storeSymbolsInStorageAllLang(JSON.parse(resp), "mr");
    });
} else if (selectedLang == 'gu') {
    B.get('/json/gujaratisymbols.json').then(function (resp) {
        storeSymbolsInStorageAllLang(JSON.parse(resp), "gu");
    });
}

function NSELangTranslator() {
    var _this2 = this;

    try {
        var allLangJSON = JSON.parse(localStorage.getItem('symbolsLang'));
    } catch (error) {}

    function changeStockSymboFieldsToHindi(stock, _ref13) {
        var hi = _ref13.hi,
            en = _ref13.en,
            gu = _ref13.gu,
            mr = _ref13.mr;

        stock['symbol_before_translate'] = stock['symbol'];
    }
    // handle symbol+ instrument
    this.translateSymbolTo = function (value, column) {
        try {
            if (!value || value === '-') {
                return value;
            }
            // in case of english or undefined, simply return symbol
            if (selectedLang != 'en' && !!selectedLang) {
                var translatedSymbol = { symbol: value };
                if (!_this2.allLangJSON) {
                    try {
                        _this2.allLangJSON = JSON.parse(localStorage.getItem('symbolsLang'));
                    } catch (error) {}
                }
                changeStockSymboFieldsToNonEng(translatedSymbol, _this2.allLangJSON);
                return translatedSymbol['symbol'] || value;
            } else {
                return value;
            }
        } catch (err) {
            console.error('(common.js)Error in translateSymbolTo', err);
        }
    };

    this.translateValueTo = function (value, column) {
        try {
            if (!value || value === '-') {
                return value;
            }
            if (selectedLang != 'en' || !selectedLang) {
                if (column.name === 'symbol') {
                    return _this2.translateSymbolTo(value, column);
                }
            }
            // return DecimalFixed(value, false, column.chkVal || false, digits, localeMap[enLocale]);
        } catch (err) {
            console.error('(common.js)Error in translateValueTo', err);
        }
    };
}

/*assigning  element_render_end_custom_event*/
document.addEventListener("element_render_end_custom_event", function (e) {
    enforceTranslationOnAllElements(e);
});

function enforceTranslationOnAllElements(event) {
    // refreshLabels is in multilang.js
    refreshLabels(event);
}

function isValidDate(dateObject) {
    return new Date(dateObject).toString() !== 'Invalid Date';
}

function noRecords() {
    return !selectedLang || selectedLang == 'en' ? 'No Records' : multilang.get('table_no_records');
}

$('a[data-bs-toggle="tab"]').on('shown.bs.tab', function (e) {
    enforceTranslationOnAllElements(e);
});

function initTranslationEvent() {
    /*assigning  element_render_end_custom_event*/
    document.addEventListener("element_render_end_custom_event", function (e) {
        enforceTranslationOnAllElements(e);
    });
}

/*
function getLocale(selectedLang) {
    switch (selectedLang) {
      case hiLocaleAcronnym:
      case guLocaleAcronnym:
      case mrLocaleAcronnym:
          return localeMap[selectedLang];
      break;
      default:
          selectedLocalecommon = localeMap['en'];
      break;    
    }
  }
  */
function loadContigencyCalenderTable() {
    B.get("/json/contingency-drill-calender.json").then(function (resp) {
        var respJSONObj = JSON.parse(resp);
        var contigencyCalender = customTable({
            tableStyle: {
                id: "contigencyCalenderTable",
                class: "common_table customHeight-table tableScroll alt_row w-100"
            },
            colData: respJSONObj.columns || [],
            rowData: []
        });
        B.render(contigencyCalender, B.findOne("#table-contigencyCalenderTable"));
        if ($("#contigencyCalenderTable").length) {
            B.findOne("#contigencyCalenderTable .emptyRow").innerHTML = loader;
        }
        var url = '/api/contingency-drill-calender';
        B.get(url).then(function (resp) {
            var respJSON = JSON.parse(resp);
            contigencyCalender.state.rowData = respJSON.data || [];
        });
    });
}

if (document.getElementsByClassName('target-blank').length > 0) {
    Array.prototype.forEach.call(document.getElementsByClassName('target-blank'), function (item) {
        return item.setAttribute("target", "_blank");
    });
}
if (document.getElementsByClassName('icon-pdf').length > 0) {
    Array.prototype.forEach.call(document.getElementsByClassName('icon-pdf'), function (item) {
        return item.setAttribute("target", "_blank");
    });
}
if (document.getElementsByClassName('icon-xls').length > 0) {
    Array.prototype.forEach.call(document.getElementsByClassName('icon-xls'), function (item) {
        return item.setAttribute("target", "_blank");
    });
}
if (document.getElementsByClassName('icon-zip').length > 0) {
    Array.prototype.forEach.call(document.getElementsByClassName('icon-zip'), function (item) {
        return item.setAttribute("target", "_blank");
    });
}
if (document.getElementsByClassName('icon-doc').length > 0) {
    Array.prototype.forEach.call(document.getElementsByClassName('icon-doc'), function (item) {
        return item.setAttribute("target", "_blank");
    });
}
if (document.getElementsByClassName('icon-csv').length > 0) {
    Array.prototype.forEach.call(document.getElementsByClassName('icon-csv'), function (item) {
        return item.setAttribute("target", "_blank");
    });
}

$(function () {
    $('#homeSlider .slick-carousel').slick({
        dots: true,
        speed: 500,
        slidesToShow: 1,
        slidesToScroll: 1,
        adaptiveHeight: true,
        arrows: false,
        autoplay: true,
        autoplaySpeed: 3000,
        infinite: false,
        fade: true,
        cssEase: 'linear',
        responsive: [{
            breakpoint: 1024,
            settings: {
                slidesToShow: 1,
                slidesToScroll: 1,
                infinite: false

            }
        }, {
            breakpoint: 600,
            settings: {
                slidesToShow: 1,
                slidesToScroll: 1
            }
        }, {
            breakpoint: 480,
            settings: {
                slidesToShow: 1,
                slidesToScroll: 1
            }
        }]
    });
    $('#homeSlider .slick-carousel').show();
    $('.tabs_boxes a.nav-item.nav-item.nav-link[data-bs-toggle="tab"]').on('shown.bs.tab', function (e) {
        $('#homeSlider .slick-carousel').slick('setPosition');
    });

    $('#homeSlider .play_pause_btn').on('click', function (e) {
        if ($(this).html() == '<i class="fa fa-pause-circle"></i>') {
            $('#homeSlider .slick-carousel').slick('slickPause');
            $(this).html('<i class="fa fa-play-circle"></i>');
        } else {
            $('#homeSlider .slick-carousel').slick('slickPlay');
            $(this).html('<i class="fa fa-pause-circle"></i>');
        }
        e.preventDefault();
    });

    $('body').on('click', '.surv-ind', function (event) {
        if ($(event.currentTarget) && $(event.currentTarget).text() && $(event.currentTarget).text().length > 3) {
            window.location = "https://nsearchives.nseindia.com/s3fs-public/inline-files/Annexure.xlsx";
        }
    });

    $('#nseMarketStatus .play_pause_btn').on('click', function (e) {
        var $button = $(this);
        var $icon = $button.find('i');

        if ($icon.hasClass('fa-pause-circle')) {
            $('#slickcarousel-widget-parent.slick-class').slick('slickPause');
            $icon.removeClass('fa-pause-circle').addClass('fa-play-circle');
            $button.attr('title', 'Play Button');
        } else {
            $('#slickcarousel-widget-parent.slick-class').slick('slickPlay');
            $icon.removeClass('fa-play-circle').addClass('fa-pause-circle');
            $button.attr('title', 'Pause Button');
        }
        e.preventDefault();
    });

    $('.slick-class').slick({
        dots: true,
        speed: 100,
        slidesToShow: 1,
        slidesToScroll: 1,
        adaptiveHeight: false,
        arrows: false,
        autoplay: true,
        autoplaySpeed: 5000,
        infinite: true,
        fade: false
        // cssEase: 'linear'
    });
    $('.slick-class').show();
    setTimeout(function () {
        addSlickKeyboardNavigation('slickcarousel-widget-parent');
    }, 2000);
});

//It will empty dropdown element and append option with empty value and 'Select' text.
function emptyDropdown(element) {
    if (!!element) {
        element.empty();
        element.append('<option value="">Select</option>');
    }
}

document.addEventListener("pagelevel-table-header-fix", function (e) {
    pageScrolltableId = $(e.detail.tableId);
    pageScrollTableIdString = e.detail.tableId;
    pageScrolltableHead = $(e.detail.tableId + ' thead');
    pageScrollOCTablePos = $(e.detail.tableId + ':visible').offset().top - ($('header').height() + $('#betaVerBand').height());
    pageScrolltabWid = $(e.detail.tableId + ':visible').width();
});

function PageScrollTableHeaderFix() {
    var posTop = $(window).scrollTop();
    try {

        if ($(window).width() > 1024 && pageScrolltableId && $(pageScrollTableIdString + ' .emptyRow').length === 0) {
            //let OCTableEndPos = $('footer').offset().top - OCTablePos - 40;
            var OCTableEndPos = pageScrollOCTablePos + pageScrolltableId.height() - 40;
            if (OCTableEndPos <= 0) {
                OCTableEndPos = OCNote.offset().top;
            }

            var tableId = void 0;
            var tableHead = void 0;

            if (posTop > pageScrollOCTablePos && posTop < OCTableEndPos && updateVal) {
                setTimeout(function () {
                    // var headerHeight = $('body').hasClass('plainTemplate') ? $('#headerContainer').height() : $('header').height() + 20;
                    var headerHeight = $('body').hasClass('plainTemplate') ? $('#headerContainer').height() : $('header').height();
                    if (tableId && tableHead && tableId !== "" && tableHead !== "") {
                        tableId.addClass('fixHeader');
                        tableHead.css({ top: headerHeight, width: pageScrolltabWid });
                    } else {
                        pageScrolltableId.addClass('fixHeader');
                        pageScrolltableHead.css({ top: headerHeight, width: pageScrolltabWid });
                    }
                    updateVal = false;
                }, 200);
            }
            if (posTop <= pageScrollOCTablePos && !updateVal) {
                if (tableId && tableHead && tableId !== "" && tableHead !== "") {
                    tableId.removeClass('fixHeader');
                    tableHead.removeAttr('style');
                } else {
                    pageScrolltableId.removeClass('fixHeader');
                    pageScrolltableHead.removeAttr('style');
                }
                updateVal = true;
            }
            if (posTop >= OCTableEndPos && !updateVal) {
                if (tableId && tableHead && tableId !== "" && tableHead !== "") {
                    tableId.removeClass('fixHeader');
                    tableHead.removeAttr('style');
                } else {
                    pageScrolltableId.removeClass('fixHeader');
                    pageScrolltableHead.removeAttr('style');
                }
                updateVal = true;
            }
        }
    } catch (e) {
        console.log(e);
    }
}

//It will hide the date picker while page scrolling
$(document).scroll(function () {
    $('.gj-picker.gj-picker-bootstrap.datepicker.gj-unselectable').hide();
});

function getColumnIndexFromJson(jsonObj, columnName) {
    return jsonObj.findIndex(function (item) {
        return item.name === columnName;
    });
}

function highlightHighValInTable(tableId, getHighColumnIndex) {
    var val = void 0;
    var highVal = void 0;
    var rowIndex = [];
    $('#' + tableId + ' tbody tr td:nth-child(' + (Number(getHighColumnIndex) + 1) + ')').each(function (index) {
        val = parseFloat($(this).html().replaceAll(',', ''));
        highVal = index === 0 ? val : highVal;
        if (index === 0) rowIndex.push(index);
        if (val == highVal) {
            rowIndex.push(index);
        }
        if (val > highVal) {
            rowIndex = [];
            rowIndex.push(index);
            // rowIndex = index;
            highVal = val;
        }
    });
    if (rowIndex.length > 0) {
        rowIndex.forEach(function (item, i) {
            $('#' + tableId + ' tbody tr:eq(' + rowIndex[i] + ') td:eq(' + getHighColumnIndex + ')').addClass('bg-success text-white');
        });
    }
}

function highlightLowValInTable(tableId, getLowColumnIndex) {
    var val = void 0;
    var rowIndex = [];
    var lowVal = void 0;
    $('#' + tableId + ' tbody tr td:nth-child(' + (Number(getLowColumnIndex) + 1) + ')').each(function (index) {
        val = parseFloat($(this).html().replaceAll(',', ''));
        lowVal = index === 0 ? val : lowVal;
        if (index === 0) rowIndex.push(index);
        // rowIndex = index === 0 ? index : rowIndex;
        if (val == lowVal) {
            rowIndex.push(index);
        }
        if (val < lowVal) {
            rowIndex = [];
            rowIndex.push(index);
            // rowIndex = index;
            lowVal = val;
        }
    });
    if (rowIndex.length > 0) {
        rowIndex.forEach(function (item, i) {
            $('#' + tableId + ' tbody tr:eq(' + rowIndex[i] + ') td:eq(' + getLowColumnIndex + ')').addClass('bg-danger text-white');
        });
    }
}

function stringToTitleCase(str) {
    return str.replace(/\w\S*/g, function (txt) {
        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
    });
}

/* @description - function fetch cms notes and append into title and note
* @param {*} apiUrl 
* @param {*} noteId 
*/
function loadCMSNotes(apiUrl, noteId) {
    B.get(apiUrl).then(function (resp) {
        var respJSON = JSON.parse(resp);
        if (respJSON && respJSON.content && respJSON.content.field_components) {
            $('#' + noteId).append('<div class="note_container">\n<h3>\n<span>' + respJSON.content.field_components[0].field_note_title.trim().replace(/(<p[^>]+?>|<p>|<\/p>)/img, "") + '</span>\n </h3>\n' + respJSON.content.field_components[1].field_note_para.trim() + '\n</div>');
        } else {
            $('#' + noteId).append('<div class="note_container">\n<h3>\n<span>Note</span>\n</h3>\n No records found\n</div>');
        }
    }).catch(function (error) {
        console.error('Error:', error);
    });
}

$(document).ready(function () {
    // function fetch cms notes using unique cms url
    function fetchCMSNotes(noteUniqUrl, noteDivChild) {
        return new Promise(function (resolve, reject) {
            B.get('/api/cmsNote?url=' + noteUniqUrl).then(function (resp) {
                var notes = JSON.parse(resp);
                resolve({ noteUniqUrl: noteUniqUrl, noteDivChild: noteDivChild, notes: notes });
            }).catch(function (err) {
                reject(err);
            });
        });
    }
    // Check if the data attribute exists
    if ($(document).find("div[data-cms-note-id]").length > 0) {
        $(document).find("div[data-cms-note-id]").each(function () {
            fetchCMSNotes($(this).data("cms-note-id"), $(this)).then(function (_ref14) {
                var noteDivChild = _ref14.noteDivChild,
                    notes = _ref14.notes;

                var respJSON = notes;
                if (respJSON && respJSON.content && respJSON.content.field_components) {
                    noteDivChild.append('<div class="note_container">\n<h3>\n<span>' + respJSON.content.field_components[0].field_note_title.trim().replace(/(<p[^>]+?>|<p>|<\/p>)/img, "") + '</span>\n </h3>\n' + respJSON.content.field_components[1].field_note_para.trim() + '\n</div>');
                } else {
                    noteDivChild.append('<div class="note_container">\n<h3>\n<span>Note</span>\n</h3>\n No records found\n</div>');
                }
            });
        });
    } else {}
    //console.info("This page does not have CMS notes.");

    /* new layout not popp  onclick added on 7 Feb 2024*/
    // $(".popup-cms-notes").click(function () {
    //     fetchCMSNotes($(this).data("cms-note-popup-id"), $(this)).then(({ noteDivChild, notes }) => {
    //         noteDivChild = $('#modal_note_ann_dahsboard_container .modal-body')
    //         const respJSON = notes;
    //         if (respJSON && respJSON.content && respJSON.content.field_components) {
    //             $('#cms_note_container').empty()
    //             $(".cms_note_container").html('<div class="note_container">' + respJSON.content.field_components[1].field_note_para.trim() + '\n</div>');
    //         } else {
    //             //noteDivChild.html('<div class="note_container">\n No records found\n</div>');
    //         }
    //     })
    // });
});

B.on(document, 'allGood', function () {
    $("a[href='https://iinvest.cogencis.com']").attr("target", "_blank");
    $("a[href='https://neaps.nseindia.com/NEWLISTINGCORP/']").attr("target", "_blank");

    // Accordian Collpase by default
    var url = '/research/publications-reports-nse-market-insights';
    var currentUrl = window.location.href;

    if (currentUrl.endsWith(url)) {
        var $accordion = $('.tab-content .tab-pane .common_accordion .card .card-body');
        if ($accordion.length && $accordion.parents('.collapse').hasClass('show')) {
            $accordion.parents('.collapse').collapse('hide');
        }
    }
    checkRegulatory();
    // keyboard navigation on option chain page
    setTimeout(function () {
        forceFocusToFooter();
    }, 2000);

    manageEventNotificationBell();
});

function checkRegulatoryforgetquotevolatility() {
    B.get('/api/regulatorymodulestatus').then(function (resp) {
        var regulatoryModulesStatus = JSON.parse(resp);
        //const regulatoryModulesStatus = await common.apiFunctionality.getRegulatoryModuleStatus();
        var QuoteVolatalityFlag = regulatoryModulesStatus && regulatoryModulesStatus.data && regulatoryModulesStatus.data.getQuoteVolatility ? regulatoryModulesStatus.data.getQuoteVolatility : 'true';
        if (QuoteVolatalityFlag === "false") {
            //$('.volatility').hide();
            $('.daily_volatility').hide();
            $('.annual_volatility').hide();
        }
    });
}

function generateHomeChart(api, id) {
    try {
        var preOpenDate = new Date();
        var norMarDate = new Date();
        preOpenDate = preOpenDate.setHours(8, 30, 0, 0);
        norMarDate = norMarDate.setHours(10, 30, 0, 0);
        // Get Graph type status 
        var currMktFlag = 'NM';
        $.getJSON('/api/homegraphtype', function (homeGrapType) {
            if (homeGrapType && homeGrapType.flag && homeGrapType.flag.length) {
                currMktFlag = homeGrapType.flag;
            }
            $.getJSON(api, function (data) {
                // Create the chart
                if (data) {
                    $.getJSON(api + '&preopen=true', function (preOpenData) {
                        if (preOpenData) {
                            graphSymbol = preOpenData.name;
                            // const lng = document.getElementById('listlanguages').value;
                            // if(lng==='hi'){
                            // Highcharts.setOptions({
                            //     lang: {
                            //       months: [
                            //         "जनवरी",
                            //         "फरवरी",
                            //         "मार्च",
                            //         "अप्रैल",
                            //         "मई",
                            //         "जून",
                            //         "जुलाई",
                            //         "अगस्त",
                            //         "सितम्बर",
                            //         "अक्टूबर",
                            //         "नवम्बर",
                            //         "दिसम्बर",
                            //       ],
                            //       shortMonths: [
                            //         "जनवरी",
                            //         "फरवरी",
                            //         "मार्च",
                            //         "अप्रैल",
                            //         "मई",
                            //         "जून",
                            //         "जुलाई",
                            //         "अगस्त",
                            //         "सितम्बर",
                            //         "अक्टूबर",
                            //         "नवम्बर",
                            //         "दिसम्बर",
                            //       ],
                            //       weekdays: [
                            //         "रविवार",
                            //         "सोमवार",
                            //         "मंगलवार",
                            //         "बुधवार",
                            //         "गुरुवार",
                            //         "शुक्रवार",
                            //         "शनिवार",
                            //       ],
                            //       thousandsSep: " ",
                            //       decimalPoint: ",",
                            //       rangeSelectorFrom: "0",
                            //       rangeSelectorTo: "50",
                            //     },
                            //   });
                            // }
                            Highcharts.stockChart(id, {
                                chart: {
                                    marginTop: 15
                                },
                                rangeSelector: {
                                    enabled: false,
                                    selected: 1,
                                    inputEnabled: false
                                },
                                credits: {
                                    enabled: false
                                },
                                title: false,
                                navigator: {
                                    enabled: false
                                },
                                scrollbar: {
                                    enabled: false
                                },
                                xAxis: {
                                    type: 'datetime'
                                },
                                shared: {
                                    enabled: true
                                },
                                yAxis: {
                                    gridLineWidth: 0,
                                    minorGridLineWidth: 0,
                                    opposite: false,
                                    plotLines: [{
                                        color: '#333',
                                        width: 1,
                                        value: data.closePrice
                                    }]
                                },
                                exporting: {
                                    enabled: true,
                                    buttons: {
                                        contextButton: {
                                            y: -15
                                        }
                                    }
                                },
                                series: [{
                                    name: ['PC', 'NM'].includes(currMktFlag) ? preOpenData.identifier || "" : "",
                                    data: ['PC', 'NM'].includes(currMktFlag) ? preOpenData.grapthData || [] : [],
                                    type: 'area',
                                    //softThreshold:false,
                                    //threshold: 'closePrice',
                                    threshold: null,
                                    tooltip: {
                                        valueDecimals: 2
                                    },
                                    /*zones: [{
                                        value: data.closePrice,
                                        color: 'red'
                                    }, {
                                        color: 'green'
                                    }],*/
                                    zones: [{
                                        value: preOpenDate,
                                        color: 'orange',
                                        fillColor: {
                                            linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
                                            stops: [[0, '#FFDCAB'], // start
                                            [1, '#fff'] // end
                                            ]
                                        }
                                    }, {
                                        value: norMarDate,
                                        color: '#FEAB25',
                                        fillColor: {
                                            linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
                                            stops: [[0, '#FFDCAB'], // start
                                            [1, '#fff'] // end
                                            ]
                                        }
                                    }, {
                                        color: 'green',
                                        fillColor: {
                                            linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
                                            stops: [[0, '#3e85c5'], // start
                                            [1, 'rgba(11, 232, 250, 0)'] // end
                                            ]
                                        }
                                    }],
                                    plotOptions: {
                                        series: {
                                            color: '#3e85c5',
                                            lineWidth: 1
                                        }
                                    },
                                    fillColor: {
                                        linearGradient: {
                                            x1: 0,
                                            y1: 0,
                                            x2: 0,
                                            y2: 1
                                        },
                                        stops: [[0, '#3e85c5'], [1, 'rgba(11, 232, 250, 0)']]
                                    } }, {
                                    name: data.identifier || "",
                                    data: data.grapthData || [],
                                    type: 'area',
                                    //softThreshold:false,
                                    //threshold: 'closePrice',
                                    threshold: null,
                                    tooltip: {
                                        valueDecimals: 2
                                    },
                                    zones: [{
                                        value: data.closePrice,
                                        color: 'red'
                                    }, {
                                        color: 'green'
                                    }],
                                    plotOptions: {
                                        series: {
                                            color: '#3e85c5',
                                            lineWidth: 1
                                        }
                                    },
                                    fillColor: {
                                        linearGradient: {
                                            x1: 0,
                                            y1: 0,
                                            x2: 0,
                                            y2: 1
                                        },
                                        stops: [[0, '#3e85c5'], [1, 'rgba(11, 232, 250, 0)']]
                                    }
                                }]
                            });
                        }
                    });
                }

                if (id == "equityIntraGraph") {
                    setTimeout(function () {
                        $('#' + id).attr({ "role": 'img', "aria-label": 'Pre-open and Intraday price Chart of ' + graphSymbol });
                    }, 2000);
                } else if (id.startsWith("currencyAllContracts")) {
                    setTimeout(function () {
                        $('#' + id).attr({ "role": 'img', "aria-label": 'Intraday price Chart of ' + data.identifier + ' Contract' });
                    }, 2000);
                } else if (id.startsWith("quoteIRFChart")) {
                    setTimeout(function () {
                        $('#' + id).attr({ "role": 'img', "aria-label": 'Intraday price Chart of ' + data.identifier + ' Contract' });
                    }, 2000);
                } else if (id.startsWith("quoteDerCont")) {
                    setTimeout(function () {
                        $('#' + id).attr({ "role": 'img', "aria-label": 'Intraday price Chart of ' + data.identifier + ' Contract' });
                    }, 2000);
                } else {
                    var graphTxt = 'Chart of Pre open ' + data.identifier + ' vs ' + data.identifier + ' indices data.The extended description is in the view data table option of the chart menu.';
                    setTimeout(function () {
                        $('#' + id).attr({ "role": 'img', "aria-label": graphTxt });
                    }, 1000);
                }
            });
        });
    } catch (error) {
        console.log("generateHomeChart", error.message);
    }
}
function downloadXBRL(url, event) {
    var originalUrl = url;
    var fileExt = url.substr(url.length - 4);
    if (fileExt === ".xml") {
        event.preventDefault();
        $.get("/api/download_xbrl?fileUrl=" + encodeURIComponent(JSON.stringify(url)), function (response) {
            if (response.error) {
                showErrorSnackBar("Error in downloading file");
            } else {
                var fileName = originalUrl.split("/").pop();
                var xmlData = new XMLSerializer().serializeToString(response);
                var blob = new Blob([xmlData], { type: "text/xml" });
                var _url = URL.createObjectURL(blob);
                var link = document.createElement("a");
                link.href = _url;
                link.download = fileName;
                document.body.appendChild(link);
                link.click();
                URL.revokeObjectURL(_url);
            }
        }).fail(function (error) {
            showErrorSnackBar("Error in downloading file");
        });
    }
}

var discountinuedDt = 'July 08,2024';
var discountinuedCirNo = '62424';
var discountinuedCirDt = 'June 12, 2024';
var discontinuedLbl = 'Discontinued w.e.f ' + discountinuedDt + '. Refer NSE Circular No. ' + discountinuedCirNo + ' dated ' + discountinuedCirDt + '.';
var filesToShowLabel = [{ 'Bhavcopy file (csv)': discontinuedLbl + ' Switch to CM-UDiFF Common Bhavcopy Final(zip)' }, { 'CM-Common Bhavcopy (csv)': discontinuedLbl + ' Switch to CM-UDiFF Common Bhavcopy Final(zip)' }, { 'CM - Bhavcopy(csv)': discontinuedLbl + ' Switch to CM-UDiFF Common Bhavcopy Final(zip)' }, { 'F&O - Bhavcopy(csv)': discontinuedLbl + ' Switch to F&O-UDiFF Common Bhavcopy Final(zip)' }, { 'F&O-Bhavcopy file (csv)': discontinuedLbl + ' Switch to F&O-UDiFF Common Bhavcopy Final(zip)' }, { 'F&O-Common Bhavcopy (csv)': discontinuedLbl + ' Switch to F&O-UDiFF Common Bhavcopy Final(zip)' }, { 'COM-Bhavcopy file (csv)': discontinuedLbl + ' Switch to COM-UDiFF Common Bhavcopy Final(zip)' }, { 'COM-Common Bhavcopy (csv)': discontinuedLbl + ' Switch to COM-UDiFF Common Bhavcopy Final(zip)' }, { 'COM - Bhavcopy file (.csv)': discontinuedLbl + ' Switch to COM-UDiFF Common Bhavcopy Final(zip)' }, { 'CD-Daily Bhavcopy(zip)': discontinuedLbl + ' Switch to CD-UDiFF Common Bhavcopy Final(zip)' }, { 'CD-Common Bhavcopy (csv)': discontinuedLbl + ' Switch to CD-UDiFF Common Bhavcopy Final(zip)' }, { 'CD - Bhavcopy': discontinuedLbl + ' Switch to CD-UDiFF Common Bhavcopy Final(zip)' }, { 'CM-UDiFF Common Bhavcopy Final (zip)': 'readme.xlsx' }, { 'F&O-UDiFF Common Bhavcopy Final (zip)': 'readme.xlsx' }];

function getFileLabel(fileName) {
    for (var _iterator7 = filesToShowLabel, _isArray7 = Array.isArray(_iterator7), _i7 = 0, _iterator7 = _isArray7 ? _iterator7 : _iterator7[Symbol.iterator]();;) {
        var _ref15;

        if (_isArray7) {
            if (_i7 >= _iterator7.length) break;
            _ref15 = _iterator7[_i7++];
        } else {
            _i7 = _iterator7.next();
            if (_i7.done) break;
            _ref15 = _i7.value;
        }

        var item = _ref15;

        for (var key in item) {
            if (fileName === key) {
                return item[key];
            }
        }
    }
    return null;
}

// to hide modal popup on click of esc - Starts
$('[tabindex]').on('click', function () {
    $('.modal-backdrop').removeClass('hide');
});
// to hide modal popup on click of esc - Ends

// for dynamic homepage chart and GetQuote Chart logic - ends
function dynamicGenerateHomeChart(api, id) {
    try {
        $.getJSON(api, function (data) {
            if (data) {
                graphSymbol = data.name;
                // Split data into different series based on the flag PO and NM
                var seriesData = [];
                var currentSeries = [];
                var currentFlag = data.grapthData[0][2];

                data.grapthData.forEach(function (point, index) {
                    if (point[2] !== currentFlag) {
                        seriesData.push({ name: currentFlag, data: currentSeries });
                        currentSeries = [];
                        currentFlag = point[2];
                    }
                    currentSeries.push([point[0], point[1]]);
                });

                seriesData.push({ name: currentFlag, data: currentSeries });

                // filling colors for the flags
                var flagColors = {
                    "PO": {
                        color: 'orange',
                        fillColor: {
                            linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
                            stops: [[0, '#FFDCAB'], // start
                            [1, '#fff'] // end
                            ]
                        }
                    },
                    "NM": {
                        color: '#3e85c5',
                        fillColor: {
                            linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
                            stops: [[0, '#3e85c5'], // start
                            [1, 'rgba(11, 232, 250, 0)'] // end
                            ]
                        }
                    }
                };

                Highcharts.stockChart(id, {
                    chart: {
                        marginTop: 15
                    },
                    rangeSelector: {
                        enabled: false,
                        selected: 1,
                        inputEnabled: false
                    },
                    credits: {
                        enabled: false
                    },
                    title: false,
                    navigator: {
                        enabled: false
                    },
                    scrollbar: {
                        enabled: false
                    },
                    xAxis: {
                        type: 'datetime'
                    },
                    shared: {
                        enabled: true
                    },
                    yAxis: {
                        gridLineWidth: 0,
                        minorGridLineWidth: 0,
                        opposite: false,
                        plotLines: [{
                            color: '#333',
                            width: 1,
                            value: data.closePrice
                        }]
                    },
                    exporting: {
                        enabled: true,
                        buttons: {
                            contextButton: {
                                y: -15
                            }
                        }
                    },
                    series: seriesData.map(function (series) {
                        return {
                            name: series.name === 'PO' ? 'Pre Open ' + data.identifier : '' + data.identifier, // Changing Label name for PO and NM
                            data: series.data,
                            type: 'area',
                            threshold: null,
                            tooltip: {
                                valueDecimals: 2
                            },
                            zones: series.name === 'NM' ? [{ // applying red and green line color based on close price only for Normal market
                                value: data.closePrice,
                                color: 'red'
                            }, {
                                color: 'green'
                            }] : '',
                            color: flagColors[series.name].color,
                            fillColor: flagColors[series.name].fillColor,
                            lineWidth: 2
                        };
                    })
                });

                var setAriaLabel = function setAriaLabel(labelText) {
                    setTimeout(function () {
                        $('#' + id).attr({ "role": 'img', "aria-label": labelText });
                    }, 2000);
                };

                if (id === "equityIntraGraph") {
                    setAriaLabel('Pre-open and Intraday price Chart of ' + graphSymbol);
                } else if (id.startsWith("currencyAllContracts")) {
                    setAriaLabel('Intraday price Chart of ' + data.identifier + ' Contract');
                } else if (id.startsWith("quoteIRFChart")) {
                    setAriaLabel('Intraday price Chart of ' + data.identifier + ' Contract');
                } else if (id.startsWith("quoteDerCont")) {
                    setAriaLabel('Intraday price Chart of ' + data.identifier + ' Contract');
                } else {
                    var graphTxt = 'Chart of Pre open ' + data.identifier + ' vs ' + data.identifier + ' indices data. The extended description is in the view data table option of the chart menu.';
                    setAriaLabel(graphTxt);
                }
            }
        });
    } catch (error) {
        console.log("generateHomeChartNew", error.message);
    }
}
// for dynamic homepage chart and GetQuote Chart logic - ends
function generateChartSPOSPreOpen(api, id) {
    try {
        $.getJSON(api, function (data) {
            if (data) {
                graphSymbol = data.name;
                Highcharts.stockChart(id, {
                    chart: {
                        marginTop: 15
                    },
                    rangeSelector: {
                        enabled: false,
                        selected: 1,
                        inputEnabled: false
                    },
                    credits: {
                        enabled: false
                    },
                    title: false,
                    navigator: {
                        enabled: false
                    },
                    scrollbar: {
                        enabled: false
                    },
                    xAxis: {
                        type: 'datetime'
                    },
                    shared: {
                        enabled: true
                    },
                    yAxis: {
                        gridLineWidth: 0,
                        minorGridLineWidth: 0,
                        opposite: false,
                        labels: {
                            formatter: function formatter() {
                                return this.value.toLocaleString('en-IN');
                            }
                        }
                        // plotLines: [{
                        //     color: '#333',
                        //     width: 1,
                        //     value: data.closePrice
                        // }]
                    },
                    exporting: {
                        enabled: false,
                        buttons: {
                            contextButton: {
                                y: -15
                            }
                        }
                    },
                    series: [{
                        name: data.identifier,
                        data: data.grapthData,
                        type: 'area',
                        //softThreshold:false,
                        //threshold: 'closePrice',
                        threshold: null,
                        tooltip: {
                            valueDecimals: 2
                        },
                        zones: [{
                            color: 'orange',
                            fillColor: {
                                linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
                                stops: [[0, '#FFDCAB'], // start
                                [1, '#fff'] // end
                                ]
                            }
                        }],
                        plotOptions: {
                            series: {
                                color: '#3e85c5',
                                lineWidth: 1
                            }
                        },
                        fillColor: {
                            linearGradient: {
                                x1: 0,
                                y1: 0,
                                x2: 0,
                                y2: 1
                            },
                            stops: [[0, '#3e85c5'], [1, 'rgba(11, 232, 250, 0)']]
                        }
                    }]
                });
            }
        });

        if (id == "equityIntraGraph") {
            setTimeout(function () {
                $('#' + id).attr({ "role": 'img', "aria-label": 'Pre-open and Intraday price Chart of ' + graphSymbol });
            }, 2000);
        } else if (id.startsWith("currencyAllContracts")) {
            setTimeout(function () {
                $('#' + id).attr({ "role": 'img', "aria-label": 'Intraday price Chart of ' + data.identifier + ' Contract' });
            }, 2000);
        } else if (id.startsWith("quoteIRFChart")) {
            setTimeout(function () {
                $('#' + id).attr({ "role": 'img', "aria-label": 'Intraday price Chart of ' + data.identifier + ' Contract' });
            }, 2000);
        } else if (id.startsWith("quoteDerCont")) {
            setTimeout(function () {
                $('#' + id).attr({ "role": 'img', "aria-label": 'Intraday price Chart of ' + data.identifier + ' Contract' });
            }, 2000);
        } else {
            var graphTxt = 'Chart of Pre open ' + data.identifier + ' vs ' + data.identifier + ' indices data.The extended description is in the view data table option of the chart menu.';
            setTimeout(function () {
                $('#' + id).attr({ "role": 'img', "aria-label": graphTxt });
            }, 1000);
        }
    } catch (error) {
        console.log("generateHomeChart", error.message);
    }
}
// Convert object to query function - start
function addQueryParams(url, params) {
    var urlObj = new URL(url);
    var searchParams = new URLSearchParams(urlObj.search);

    for (var key in params) {
        if (params && key && params.hasOwnProperty(key)) {
            searchParams.set(key, params[key]);
        }
    }

    urlObj.search = searchParams.toString();
    return urlObj.toString();
}
// Convert object to query function - end

// Convert object to query function for relative resource - start
function addQueryParamsInternal(url, params) {
    var searchParams = new URLSearchParams(url.split('?')[1] || '');

    for (var key in params) {
        if (params && key && params.hasOwnProperty(key)) {
            searchParams.set(key, params[key]);
        }
    }

    var baseUrl = url.split('?')[0];
    var newUrl = baseUrl + '?' + searchParams.toString();
    return newUrl;
}
// Convert object to query function relative resource - end

// Get key based on the value from a map - start
function getKeysByValueFromMap(map, val) {
    for (var _iterator8 = map.entries(), _isArray8 = Array.isArray(_iterator8), _i8 = 0, _iterator8 = _isArray8 ? _iterator8 : _iterator8[Symbol.iterator]();;) {
        var _ref16;

        if (_isArray8) {
            if (_i8 >= _iterator8.length) break;
            _ref16 = _iterator8[_i8++];
        } else {
            _i8 = _iterator8.next();
            if (_i8.done) break;
            _ref16 = _i8.value;
        }

        var _ref17 = _ref16,
            key = _ref17[0],
            value = _ref17[1];

        if (value === val) {
            return key;
        }
    }
    return null;
}
// Get key based on the value from a map - end

//common alert message popup to display error or success message in bootstrap alert.
//this can be used in forms
function showAlert(message, alertType, alertSec) {
    var alertContainer = document.getElementById('alert-container');
    // Create the alert HTML
    var alertHTML = '\n<div class="alert alert-' + alertType + ' alert-dismissible fade show" role="alert">\n            ' + message + '\n<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\n</div>\n    ';
    // Add the alert to the container
    alertContainer.innerHTML = alertHTML;
    // Remove the alert after 5 seconds
    setTimeout(function () {
        alertContainer.innerHTML = ''; // Clear the alert
    }, Number(alertSec || 3) * 1000);
}

function historyback() {
    if (window.history.length > 1) {
        window.history.back();
    } else {
        window.location.href = '/';
    }
    return true;
}

// check inactivity for discoonecting websocket
function checkActivitySetup() {
    document.body.addEventListener("mousemove", resetTimer, false);
    document.body.addEventListener("mousedown", resetTimer, false);
    document.body.addEventListener("keypress", resetTimer, false);
    document.body.addEventListener("DOMMouseScroll", resetTimer, false);
    document.body.addEventListener("mousewheel", resetTimer, false);
    document.body.addEventListener("touchmove", resetTimer, false);
    document.body.addEventListener("MSPointerMove", resetTimer, false);
}

function connectWebsocket() {
    // wait 5min before calling disconnectWebsocket
    if (window.streamHeaderNifty) {
        streamHeaderNifty(true, 'high');
        timeoutID = window.setTimeout(disconnectWebsocket, 300000);
    }
}

function resetTimer(e) {
    window.clearTimeout(timeoutID);
    timeoutID = window.setTimeout(disconnectWebsocket, 300000);
    timeoutID = window.setTimeout(disconnectHeatMapWebsocket, 300000);
}

function disconnectWebsocket() {
    streamHeaderNifty(false);
    initQuoteStream(false);
    try {
        if (streamActiveIndexSegment) {
            streamIndex(streamActiveIndexSegment, false);
            $('#stream-' + streamActiveIndexSegment).prop('checked', false);
        } else if (indicesWebsocket) {
            streamHeatMapIndex(false);
            $("#stream-heatmap-tile").prop("checked", false);
        }
    } catch (e) {
        console.log("not on indices page", e);
    }
}

function disconnectHeatMapWebsocket() {
    streamHeatMapIndex(false);
    $("#stream-heatmap-tile").prop("checked", false);
}
// func return html with highlighted green/red depending on change wrt to prev value
function highlightPriceChange(oldPrice, newPrice, flag) {
    var textClass = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : ["greenBlnk", "redBlnk"];


    var statusClass = void 0;
    if (flag) {
        statusClass = textClass[0];
    } else {
        statusClass = textClass[1];
    }

    // Split the prices into integer and decimal parts
    var oldParts = oldPrice.split(".");
    var newParts = newPrice.split(".");
    var highlightedPrice = "";

    // Compare the integer part
    var oldInt = oldParts[0];
    var newInt = newParts[0];
    var diffIndex = -1;

    for (var i = 0; i < newInt.length; i++) {
        if (oldInt[i] !== newInt[i]) {
            diffIndex = i;
            break;
        }
    }

    if (diffIndex === -1) {
        // No change in integer part        
        highlightedPrice = newInt;
    } else {
        // Highlight the changed portion of the integer part        
        highlightedPrice = '<span>' + newInt.substring(0, diffIndex) + '</span>' + ('<span class="highlight ' + statusClass + '">' + newInt.substring(diffIndex) + '.' + newParts[1] + '</span>');
        return highlightedPrice;
    }

    // Compare the decimal part (if any)
    if (oldParts[1] && newParts[1]) {
        var oldDec = oldParts[1];
        var newDec = newParts[1];
        if (oldDec !== newDec) {
            highlightedPrice += '.<span class="highlight ' + statusClass + '">' + newDec + '</span>';
        } else {
            highlightedPrice += '.' + newDec;
        }
        return highlightedPrice;
    }
}
var inputElement = document.getElementById('header-search-input');
var placeholderText = "Search by company name, symbol or keyword...";
var index = 0;
function animatePlaceholder() {
    inputElement.setAttribute("placeholder", placeholderText.substring(0, index));
    index++;
    if (index > placeholderText.length) {
        index = 0;
    }
}

setInterval(animatePlaceholder, 150); // Adjust speed as needed
$(".preventDefault").on("click", function (event) {
    event.preventDefault();
});

/* document.getElementById('P9LngDdl').addEventListener('change', function() {
     
     if (!lastKeyWasEscape) {
         //RedirectUrl(this.value);
         console.log('chennai - open page- RedirectUrl/. lastKeyWasEscape==>', lastKeyWasEscape);
     } else {
         console.log('do not go anywere');
     }
     // Important: Reset after handling
     lastKeyWasEscape = false;
   });*/

var refreshMarketTurnOverEvent = true;
function refreshmarketTurnOver() {
    if (refreshMarketTurnOverEvent) {
        refreshMarketTurnOverEvent = false;
        // $('#derRatio').text('');
        $('#marketTurnover>tbody').empty();
        B.get('/json/market-turnover-popup.json').then(function (resp) {
            var respJSON = JSON.parse(resp);
            tablemarketTurnover = customTableNoHead({
                tableStyle: { class: '' },
                colData: respJSON.columns || [],
                rowData: [],
                marketturnover: 1
            });
            B.render(tablemarketTurnover, B.findOne('#marketTurnover'));
            B.findOne("#marketTurnover .emptyRow").innerHTML = loader;

            // B.get('/api/regulatorymodulestatus').then(function (resp) {
            // let regulatoryModulesStatus = JSON.parse(resp);
            var marketTurnoverAPI = "/api/market-turnover-popup";
            // let homeMarketTurnoverFlag = regulatoryModulesStatus && regulatoryModulesStatus.data && regulatoryModulesStatus.data.home_market_turnover ? regulatoryModulesStatus.data.home_market_turnover : 'true';
            // if (homeMarketTurnoverFlag === "false") {
            // $('.mt-detail-view').hide();
            // marketTurnoverAPI = "/api/market-turnover";
            // }

            B.get(marketTurnoverAPI).then(function (resp) {
                var resData = JSON.parse(resp);
                var selVal = $("#radio_marketTurnOver").find("input:checked").val();
                convertToValue(selVal, tablemarketTurnover);
                tablemarketTurnover.state.rowData = resData.data || [];
                $('#marketTurnover tbody tr td span').each(function () {
                    $(this).closest('tr').find('td').css({ 'font-weight': 'bold', 'color': '#3a2d7d' });
                    $(this).closest('tr').css('background', '#3b2e7d0d');
                    $(this).closest('td').css('background', '#F5F4F8');
                });
                //$('#derRatio').text(resData.derivativeToCashRatio);
                var nsetranslateEvent = new CustomEvent('element_render_end_custom_event');
                document.dispatchEvent(nsetranslateEvent);
            });

            // });

        });
        setTimeout(function () {
            refreshMarketTurnOverEvent = true;
        }, 2000);
    }
}
function fileSizeRender(key, row) {
    var convertobytes = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;

    var fileSizeString = '';
    if (row && key && row[key]) {
        if (convertobytes) {
            fileSizeString = '(' + formatBytes(row[key]) + ')';
        } else {
            fileSizeString = '(' + row[key] + ')';
        }
    }
    return fileSizeString;
}

function highlightPriceChangeQuotes(oldPrice, newPrice, flag) {
    var textClass = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : ["greenBlnkQuote1", "redBlnkQuote1"];


    var statusClass = void 0;
    if (flag) {
        statusClass = textClass[0];
    } else {
        statusClass = textClass[1];
    }
    // Split the prices into integer and decimal parts
    var oldParts = oldPrice.split(".");
    var newParts = newPrice.split(".");
    var highlightedPrice = "";

    // Compare the integer part
    var oldInt = oldParts[0];
    var newInt = newParts[0];
    var diffIndex = -1;

    for (var i = 0; i < newInt.length; i++) {
        if (oldInt[i] !== newInt[i]) {
            diffIndex = i;
            break;
        }
    }

    if (diffIndex === -1) {
        // No change in integer part        
        highlightedPrice = newInt;
    } else {
        // Highlight the changed portion of the integer part        
        highlightedPrice = '<span>' + newInt.substring(0, diffIndex) + '</span>' + ('<span class="highlight ' + statusClass + '">' + newInt.substring(diffIndex) + '.' + newParts[1] + '</span>');
        return highlightedPrice;
    }

    // Compare the decimal part (if any)
    if (oldParts[1] && newParts[1]) {
        var oldDec = oldParts[1];
        var newDec = newParts[1];
        if (oldDec !== newDec) {
            highlightedPrice += '.<span class="highlight ' + statusClass + '">' + newDec + '</span>';
        } else {
            highlightedPrice += '.' + newDec;
        }
        return highlightedPrice;
    }
}

// gigw- nav-link
document.addEventListener('DOMContentLoaded', function () {
    var navLinks = document.querySelectorAll(".nav-link.dd-link");
    function closeAllDropdowns() {
        navLinks.forEach(function (lnk) {
            var menu = lnk.parentElement.querySelector(".dropdown-menu");
            if (menu) {
                menu.classList.remove("show");
                menu.style.display = "";
                menu.style.opacity = "";
                menu.style.visibility = "";
                lnk.setAttribute("aria-expanded", "false");
            }
        });
    }

    navLinks.forEach(function (link) {
        var dropdownMenu = link.parentElement.querySelector(".dropdown-menu");

        if (!dropdownMenu) return;

        function openDropdown() {
            var show = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;
            if (show) {
                // closed others before opening current
                closeAllDropdowns();
                dropdownMenu.classList.add("show");
                dropdownMenu.style.display = "block";
                dropdownMenu.style.opacity = "1";
                dropdownMenu.style.visibility = "visible";
                link.setAttribute("aria-expanded", "true");
            } else {
                dropdownMenu.classList.remove("show");
                dropdownMenu.style.display = "";
                dropdownMenu.style.opacity = "";
                dropdownMenu.style.visibility = "";
                link.setAttribute("aria-expanded", "false");
            }
        }

        // Open on focus
        link.addEventListener("focus", function () {
            return openDropdown(true);
        });

        // Optional blur handler to close (with delay in case submenu is focused)
        link.addEventListener("blur", function () {
            setTimeout(function () {
                if (!dropdownMenu.contains(document.activeElement)) openDropdown(false);
            }, 200);
        });

        // Handle direct keydown on top-level link
        link.addEventListener("keydown", function (e) {
            if (e.key === "Escape") {
                openDropdown(false);
                link.blur();
            }

            if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                openDropdown(true);
            }

            if (e.key === "ArrowDown") {
                e.preventDefault();
                openDropdown(true);
                var firstLink = dropdownMenu.querySelector("a");
                if (firstLink) firstLink.focus();
            }
        });

        // Handle Escape within dropdown menu
        dropdownMenu.addEventListener("keydown", function (e) {
            if (e.key === "Escape") {
                e.stopPropagation();
                openDropdown(false);
                link.focus(); // Bring focus back to main item
            }
        });

        // NEW: Close dropdown when focus leaves the menu
        dropdownMenu.addEventListener("focusout", function (e) {
            setTimeout(function () {
                if (!dropdownMenu.contains(document.activeElement)) {
                    openDropdown(false);
                }
            }, 100);
        });

        // Outside click = close
        document.addEventListener("click", function (e) {
            if (!link.contains(e.target) && !dropdownMenu.contains(e.target)) {
                openDropdown(false);
            }
        });
    });
});

document.addEventListener('keydown', function (e) {
    if (e.key === 'Tab') {
        document.body.classList.add('keyboard-navigation');
    }
});

document.addEventListener('mousedown', function () {
    document.body.classList.remove('keyboard-navigation');
});

document.addEventListener('DOMContentLoaded', function () {
    var dropdown = document.getElementById('P9LngDdl');
    var selected = dropdown.querySelector('.selected');
    var options = dropdown.querySelector('.options');
    var optionItems = Array.from(options.querySelectorAll('li'));
    // accessblity icon 
    var accessblity = document.querySelector('.accessblityBtn');
    var accessblityDropdown = document.querySelector('.dropdown .dropdownContent');

    var currentIndex = -1;

    // Toggle dropdown on click
    dropdown.addEventListener('click', function () {
        dropdown.classList.toggle('open');
        if (dropdown.classList.contains('open')) {
            currentIndex = -1;
            highlightOption(currentIndex);
        }
    });

    // Select option on click
    optionItems.forEach(function (option, index) {
        option.addEventListener('click', function () {
            selectOption(index);
        });
    });

    // Keyboard navigation
    dropdown.addEventListener('keydown', function (e) {
        if (e.key === 'ArrowDown') {
            e.preventDefault();
            if (!dropdown.classList.contains('open')) {
                dropdown.classList.add('open');
            }
            currentIndex = (currentIndex + 1) % optionItems.length;
            highlightOption(currentIndex);
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            if (!dropdown.classList.contains('open')) {
                dropdown.classList.add('open');
            }
            currentIndex = (currentIndex - 1 + optionItems.length) % optionItems.length;
            highlightOption(currentIndex);
        } else if (e.key === 'Enter') {
            e.preventDefault();
            if (dropdown.classList.contains('open') && currentIndex >= 0) {
                selectOption(currentIndex);
            } else {
                dropdown.classList.add('open');
            }
        } else if (e.key === 'Escape') {
            dropdown.classList.remove('open');
        }
    });

    // Blur closes dropdown
    dropdown.addEventListener('blur', function () {
        dropdown.classList.remove('open');
    });
    function highlightOption(index) {
        optionItems.forEach(function (opt, i) {
            opt.style.background = i === index ? '#e0e0e0' : '';
        });
    }
    function selectOption(index) {
        var option = optionItems[index];
        if (option) {
            var selectedLanguage = option.textContent;
            selected.textContent = selectedLanguage;
            localStorage.setItem('selectedLanguage', selectedLanguage); // Save to localStorage
            RedirectUrl(option.dataset.value);
        }
    }
    var savedLanguage = localStorage.getItem('selectedLanguage');
    if (savedLanguage) {
        selected.textContent = savedLanguage;
    }
    accessblity.addEventListener('click', function (e) {
        e.stopPropagation(); // Prevent click from bubbling to document
        accessblityDropdown.style.display = accessblityDropdown.style.display === 'block' ? 'none' : 'block';
    });
    // Hide dropdown on click outside
    document.addEventListener('click', function (e) {
        if (!accessblity.contains(e.target) && !accessblityDropdown.contains(e.target)) {
            accessblityDropdown.style.display = 'none';
        }
    });
    // Hide dropdown on Escape key
    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
            accessblityDropdown.style.display = 'none';
        }
    });
});

// santize each form data before sending db
function sanitizeInput(str) {
    return str.replace(/[&<>"']/g, function (match) {
        return {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#39;'
        }[match];
    });
}

// show Date/ Time in footer
(function () {
    try {
        var showDateTime = document.getElementById('showDateTime');
        if (!showDateTime) {
            console.warn("Element with ID 'showDateTime' not found.");
            return;
        }

        // Get current time in IST
        var now = new Date();
        var istTime = new Date(now.toLocaleString("en-US", { timeZone: "Asia/Kolkata" }));

        if (isNaN(istTime.getTime())) {
            console.error("Failed to convert time to IST.");
            return;
        }

        var day = istTime.getDate();
        var month = istTime.toLocaleString('en-US', { month: 'short' });
        var year = istTime.getFullYear().toString();

        var hours = String(istTime.getHours()).padStart(2, '0'); // 24-hour format
        var minutes = String(istTime.getMinutes()).padStart(2, '0');

        var formatted = day + ' ' + month + ' ' + year + ' | ' + hours + ':' + minutes + ' (IST)';
        showDateTime.innerHTML = formatted;
    } catch (error) {
        console.error("An error occurred while displaying the date and time:", error);
    }
})();

function forceFocusToFooter() {
    try {
        var $firstFooterChild = $("footer ul.quick_list li:first-child a").eq(0);
        $('.tab-pane').each(function () {
            // For each UL inside this tab
            $(this).find('.note_container ul').each(function () {
                // Select the last <a> in the list and attach keydown listener
                var lastAnchor = $(this).find('a:last-child').last();
                if (!lastAnchor) {
                    return;
                }
                lastAnchor.on('keydown', function (e) {
                    if (e.key === "Tab" && !e.shiftKey) {
                        e.preventDefault();
                        if ($firstFooterChild) {
                            $firstFooterChild.attr("tabindex", "0");
                            // Force focus with a slight delay
                            setTimeout(function () {
                                $firstFooterChild.focus();
                            }, 10);
                            // Animate page scroll to that position in 500ms
                            $('html, body').animate({ scrollTop: $firstFooterChild.offset().top }, 500);
                        }
                    }
                });
            });
        });
    } catch (error) {}
}

/*fix: B.post lib code does not return reject. 
this function uses B.post lib internal code and add reject scenario */
function CustomBPostApiCall(url, data) {
    return new Promise(function (resolve, reject) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function () {
            if (xmlHttp.readyState == 4) {
                if (xmlHttp.status == 200 || xmlHttp.status === 301) {
                    try {
                        resolve(JSON.parse(xmlHttp.responseText));
                    } catch (error) {
                        resolve(xmlHttp.responseText);
                    }
                } else if (xmlHttp.status === 403) {
                    // Handle 403 Forbidden
                    reject({
                        status: 403,
                        statusText: 'Forbidden',
                        response: xmlHttp.responseText
                    });
                } else {
                    // Handle other errors
                    reject({
                        status: xmlHttp.status,
                        statusText: xmlHttp.statusText,
                        response: xmlHttp.responseText
                    });
                }
            }
        };
        xmlHttp.open("POST", url, true);
        xmlHttp.setRequestHeader("Content-type", "application/json");
        xmlHttp.send(JSON.stringify(data));
    });
}

/*gigw-fix- carousel keyboard navigation */
function addSlickKeyboardNavigation(parentElemId) {
    var carousel = document.getElementById(parentElemId);
    if (carousel) {
        carousel.addEventListener('keydown', function (e) {
            // Arrow Left - Previous Slide
            if (e.key === "ArrowLeft") {
                $('#' + parentElemId + '.slick-class').slick('slickPrev');
                e.preventDefault();
            }
            // Arrow Right - Next Slide
            else if (e.key === "ArrowRight") {
                    $('#' + parentElemId + '.slick-class').slick('slickNext');
                    e.preventDefault();
                }
                // Enter - play/pause btn
                else if (e.key === "Enter") {
                        var $button = $(carousel).find('.play_pause_btn');
                        var $icon = $button.find('i');
                        if ($icon.hasClass('fa-pause-circle')) {
                            $('#' + parentElemId + '.slick-class').slick('slickPause');
                            $icon.removeClass('fa-pause-circle').addClass('fa-play-circle');
                            $button.attr('title', 'Play Button');
                        } else {
                            $('#' + parentElemId + '.slick-class').slick('slickPlay');
                            $icon.removeClass('fa-play-circle').addClass('fa-pause-circle');
                            $button.attr('title', 'Pause Button');
                        }
                        e.preventDefault();
                    }
        });
    }
}
// format byte for press release  
function formatBytes(bytes) {
    var units = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
    if (bytes === 0) return '0 Bytes';
    if (!bytes || bytes === null || typeof bytes === 'undefined') return '';

    var i = Math.floor(Math.log(bytes) / Math.log(1024));
    var value = bytes / Math.pow(1024, i);

    return value.toFixed(2) + ' ' + units[i];
}

// Progress circle 
document.addEventListener("DOMContentLoaded", function () {
    // Create the progress circle container
    var progressDiv = document.createElement("div");
    progressDiv.className = "progressCircle";
    progressDiv.setAttribute("tabindex", "0");
    progressDiv.setAttribute("title", "Go to Top");
    progressDiv.setAttribute("aria-label", "Go to Top");

    // Set inner HTML for SVG
    progressDiv.innerHTML = '\n    <svg class="svg" viewBox="0 0 36 36">\n      <path class="circleBg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>\n      <path class="circle" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>\n      <text x="18" y="22" text-anchor="middle" class="arrow"> \u2191 </text>\n    </svg>\n  ';

    // Append to body
    document.body.appendChild(progressDiv);

    // Scroll progress logic
    var progressCircle = progressDiv.querySelector(".circle");
    var updateProgress = function updateProgress() {
        var scrollTop = window.scrollY;
        var docHeight = document.documentElement.scrollHeight - window.innerHeight;
        var scrollPercent = scrollTop / docHeight * 100;
        var dashArray = scrollPercent + ', 100';
        progressCircle.setAttribute("stroke-dasharray", dashArray);
    };

    window.addEventListener("scroll", updateProgress);
    updateProgress(); // initial call

    // Scroll to top on click
    progressDiv.addEventListener("click", function () {
        window.scrollTo({ top: 0, behavior: "smooth" });
    });
});

function getStocksGraph(symbol, series, marketType, row, stockType) {
    try {
        var finalSymbol = series == 'undefined' || series == undefined || series == null ? symbol : '' + symbol + series + marketType;
        // console.log('finalSymbol :::',finalSymbol)
        // console.log('row :::', row);
        // row = JSON.parse(row);
        // Clean incoming JSON string (removes bad control chars)
        row = row.replace(/[\n\r\t]/g, '').trim();
        row = row.replace(/[\u0000-\u001F\u007F]/g, '');

        // Now parse safely
        row = JSON.parse(row);
        // console.log('row after parse:::', row);

        // Clear existing content
        var stocksGraphDiv = document.getElementById('StocksGraph');
        if (stocksGraphDiv) {
            stocksGraphDiv.innerHTML = '';
        }
        var container = document.getElementById('divContainer');
        if (container) {
            container.innerHTML = '';
        }
        if (stockType === 'SPO') {
            generateChartSPOSPreOpen('/api/chart-databyindex-spos-preopen?index=' + encodeURIComponent(finalSymbol), 'StocksGraph');
            B.findOne('#ChartLabel').innerText = "Today's Special Pre-Open Chart";
        } else if (row.instrumentType === 'FUTIDX') {
            generatePreopenChart('/api/chart-databyindex-preopen-fo?index=' + encodeURIComponent(row.identifier), 'StocksGraph', true);
            B.findOne('#ChartLabel').innerText = "Today's Index Chart";
        } else if (row.instrumentType === 'FUTSTK') {
            generatePreopenChart('/api/chart-databyindex-preopen-fo?index=' + encodeURIComponent(row.identifier), 'StocksGraph', true);
            B.findOne('#ChartLabel').innerText = "Today's Stock Chart";
        } else if (stockType === 'PO') {
            generatePreopenChart('/api/chart-databyindex-spos-preopen?index=' + encodeURIComponent(finalSymbol) + '&preopen=true', 'StocksGraph', true);
            B.findOne('#ChartLabel').innerText = "Today's Pre-Open Chart";
        } else if (stockType === 'INDEX' || row.priority == 1) {
            dynamicGenerateHomeChart('/api/chart-databyindex-dynamic?index=' + encodeURIComponent(finalSymbol) + '&type=index', 'StocksGraph');
            B.findOne('#ChartLabel').innerText = "Today's Index Chart";
        } else {
            dynamicGenerateHomeChart('/api/chart-databyindex-dynamic?index=' + encodeURIComponent(finalSymbol) + '&type=symbol', 'StocksGraph');
            B.findOne('#ChartLabel').innerText = "Today's Stock Chart";
        }
        B.findOne('#symbolChart').innerText = stockType === 'INDEX' ? row.index : row.instrumentType === 'FUTIDX' || row.instrumentType === 'FUTSTK' ? row.identifier : row.symbol;
        // Create the hover table div
        var hoverDiv = document.createElement('div');
        hoverDiv.id = symbol + 'graph';
        hoverDiv.className = 'hover_table';
        hoverDiv.setAttribute('role', 'tooltip');
        hoverDiv.setAttribute('aria-hidden', 'true');
        hoverDiv.innerHTML = '\n            <table class=\'common_table\'>\n              <thead>\n                <tr>\n                  <th class="low_padding_th text-center" colspan="2">' + (row.date365dAgo || '-') + '</th>\n                  <th class="low_padding_th text-center" colspan="2">' + (row.date30dAgo || '-') + '</th>\n                </tr>\n                <tr>\n                  <th width="25%" class="text-center">Past 365 Days</th>\n                  <th width="25%" class="text-center">365 d % chng</th>\n                  <th width="25%" class="text-center">Past 30 Days</th>\n                  <th width="25%" class="text-center">30 d % chng</th>\n                </tr>\n              </thead>\n              <tbody>\n                  <tr>\n                    <td width="25%" class="text-center">' + (row.chart365dPath ? '<img class="graph_icon_tbl" src="' + row.chart365dPath + '" alt="Graph image for ' + row.symbol + ' Past 365 Days">' : '-') + '</td>\n                    <td width="25%" class="text-center">' + (row.perChange365d || '-') + '</td>\n                    <td width="25%" class="text-center">' + (row.chart30dPath ? '<img class="graph_icon_tbl" src="' + row.chart30dPath + '" alt="Graph image for ' + row.symbol + ' Past 365 Days">' : '-') + '</td>\n                    <td width="25%" class="text-center">' + (row.perChange30d || '-') + '</td>\n                  </tr>\n              </tbody>\n            </table>\n        ';
        container.appendChild(hoverDiv);
    } catch (e) {
        console.error("getStocksGraph function error  :", e.message);
    }
}

function manageEventNotificationBell() {
    console.log('fetching manageEventNotificationBell...', new Date());

    $("#eventNotifyViewallBtn").click(function () {
        window.location.href = "/events";
        // Alternative to open in a new tab/window:
        // window.open("/event", '_blank'); 
    });
    $(document).on('click', 'newevent-item, .newevent-item *', function (event) {
        // 'this' refers to the specific element that was clicked
        var clickedElement = $(this);
        var parentItem = clickedElement.closest('.newevent-item');
        console.log('slugurl===>', $(parentItem).data('slugurl'));
        // Optional: stop the event from bubbling up further if needed
        event.stopPropagation();
        window.location.href = '/events' + parentItem.data('slugurl');
    });

    var $container = $("#en-c");
    var $viewAllBtn = $container.find(".event_galary_notification_viewall");

    // We clear everything except the "View All" button
    // $container.find(".event-item").remove();
    $viewAllBtn.before('<div class="loading-text">Fetching...</div>');
    var $eventScroll = $(".dropdown_scroll");
    // 2. Call the AJAX service
    B.get('/api/eventnotification').then(function (resp) {
        if (resp) {

            var resData = JSON.parse(resp);
            if (resData && resData.data && resData.data.length) {
                var notifications = resData.data || [];
                // Remove the loading message
                $container.find(".loading-text").remove();

                $.each(notifications, function (index, note) {
                    try {
                        // if note.EVENT_DATE_LABEL is TODAY THEN show event-today-dot,by default it is hidden
                        if (note && note.EVENT_DATE_LABEL && note.EVENT_DATE_LABEL.toUpperCase() === 'TODAY') {
                            $(".event-today-dot").removeClass('d-none').show();
                        }
                        var eventDateStr = '';
                        if (note.EVENT_END_TIMESTAMP && new Date(note.EVENT_END_TIMESTAMP).toDateString() === new Date(note.EVENT_START_TIMESTAMP).toDateString()) {
                            // for same date only display EVENT_START_TIMESTAMP in format of 25_Dec-2025
                            eventDateStr = eventdateFormat2(note.EVENT_START_TIMESTAMP);
                        } else {
                            // for diff date both display EVENT_START_TIMESTAMP and EVENT_END_TIMESTAMP in format of 25_Dec-2025
                            eventDateStr = eventdateFormat2(note.EVENT_START_TIMESTAMP) + ' to ' + eventdateFormat2(note.EVENT_END_TIMESTAMP);
                        }

                        var eventHtml = '<div\n                            key=' + note.ID + '\n                            class="event_galary_notification_item newevent-item"\n                            data-slugurl="' + note.SLUG_URL + '"\n                            \n                            >\n                                <img src="' + note.THUMBNAIL_URL + '" alt="thumb" class="event_galary_notification_thumb" onError={} />\n                                <div class="event_galary_notification_rightblock">\n                                    <div class="d-flex event_galary_notification_rightblock_child">\n                                        <div class="event_galary_notification_date">' + eventDateStr + '</div>\n                                        ' + (note.EVENT_DATE_LABEL && note.EVENT_DATE_LABEL.toUpperCase() === 'UPCOMING' ? '<div class="event_galary_notification_tag">Upcoming</div>' : '') + ' \n                                </div>\n\n                                <div class="event_galary_notification_title" title=' + note.TITLE + ' >\n                                    ' + (note.TITLE.length > 30 ? note.TITLE.substring(0, 30) + "..." : note.TITLE) + '</div>\n                                </div>\n                            </div>';

                        // Insert before the "View All" button
                        $eventScroll.append(eventHtml);
                    } catch (error) {
                        console.error('(common.js)|Error catched in eventnotification===>', error);
                    }
                });
            }
        }
    });

    var $bell = $("#eventNotificationBell");
    var $dropdown = $(".dropdownEventContent");

    $dropdown.hide();

    $bell.on("click", function (e) {
        e.stopPropagation();
        $dropdown.toggle();
    });

    // HOVER: show
    $bell.on("mouseenter", function () {
        $dropdown.show();
    });

    // Keep open when hovering over dropdown
    $dropdown.on("mouseenter", function () {
        $(this).show();
    });

    // Hide when leaving bell or dropdown
    $bell.add($dropdown).on("mouseleave", function () {
        $dropdown.hide();
    });

    // Click outside closes dropdown
    $(document).on("click", function () {
        $dropdown.hide();
    });
}